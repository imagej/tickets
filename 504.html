<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  
  <!-- See: http://trac.edgewall.org/wiki/TracInterfaceCustomization -->


  <head>
    <title>
      #504 (Legacy layer gotchas)
     â€“ ImageJ
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link rel="stylesheet" href="trac.css" type="text/css" /><link rel="stylesheet" href="ticket.css" type="text/css" /><link rel="stylesheet" href="tracvote.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>
  <body>
    <div id="main">
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="/ticket/504">Ticket #504</a>
          <span class="status">(closed defect: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened 2011-05-06T17:24:26-05:00</p>
    <p>Last modified 2011-05-10T15:05:09-05:00</p>
  </div>
  <h2 class="summary searchable">Legacy layer gotchas</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        bdezonia
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        bdezonia
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              major
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="closed milestone" href="/milestone/biweekly-2011%3A%20May-09%20to%20May-20">biweekly-2011: May-09 to May-20</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              Legacy Compatibility
        </td>
        <th id="h_version">
          Version:
        </th>
        <td headers="h_version">
              
        </td>
    </tr><tr>
        <th id="h_severity">
          Severity:
        </th>
        <td headers="h_severity">
              serious
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby">
        </td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking">
        </td>
        <th>
        </th>
        <td>
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
If an IJ1 plugin modifies the ImageStack of an ImagePlus that is associated with a Dataset right now this is mostly undetected. If user adds or deletes a slice we catch it.<br />
</p>
<p>
Otherwise imagine a user reorders planes within the stack. Since this can be done by getting the internal Object[] slice stack of the ImageStack and manipulating it we have little recourse. We might have to record the stack order before the plugin call and check it afterwards.<br />
</p>
<p>
Or imagine that a user calls imp.setStack(newStack). We might have to intercept this call in the legacy layer and do something smart.<br />
</p>

    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed 2011-05-10T11:02:17-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>accepted</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Attempted to be notified when setStack() called in the LegacyManager but that lead to manager initialization errors. Also setStack() called inside ImagePlus constructors so its possible to pass an ImagePlus along that is not fully constructed.<br />
</p>
<p>
Since setStack() usually updates the gui I detect calls to repaintWindow() in LegacyManager. So many manipulations of the stack can now be caught.<br />
</p>
<p>
But the reordering of planes within the stack by using the Object[] array is not supported. I saw this done in ImageJA but not in any other plugin that ships with vanilla IJ1. Can't speak here for other plugins shipped with Fiji.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed 2011-05-10T15:05:09-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>accepted</em> to <em>closed</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
improve the ability of IJ1 changes to be mirrored in IJ2 data structures by editing LegacyImageMap. The changes involved assigning the plane references of an IJ2 planar dataset to be equal to the planes of the ImagePlus returned from the plugin. If the plugin made changes to the actual stored plane references (via such methods as setPixels(), setProcessor(), or direct reordering of the stack by its internal array reference) they get copied back to IJ2.<br />
</p>

    </div>

              </div>
          </div>
        </div>
    </div>
    </div>
  </body>
</html>
