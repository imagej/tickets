<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  
  <!-- See: http://trac.edgewall.org/wiki/TracInterfaceCustomization -->


  <head>
    <title>
      #1724 (File Revert has limitations)
     â€“ ImageJ
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link rel="search" href="/search" />
        <link rel="prev" href="/ticket/1723" title="Ticket #1723" />
        <link rel="last" href="/ticket/2043" title="Ticket #2043" />
        <link rel="help" href="/wiki/TracGuide" />
        <link rel="alternate" href="/ticket/1724?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="/ticket/1724?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="/ticket/1724?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="/ticket/1725" title="Ticket #1725" />
        <link rel="start" href="/wiki" />
        <link rel="stylesheet" href="/chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="/chrome/common/css/ticket.css" type="text/css" /><link rel="stylesheet" href="/chrome/vote/css/tracvote.css" type="text/css" />
        <link rel="first" href="/ticket/1" title="Ticket #1" />
        <link rel="shortcut icon" href="/chrome/site/imagej-16.png" type="image/png" />
        <link rel="icon" href="/chrome/site/imagej-16.png" type="image/png" />
      <link type="application/opensearchdescription+xml" rel="search" href="/search/opensearch" title="Search ImageJ" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="5dd217a1f3bc7c308824579e";
    </script>
    <script type="text/javascript" src="/chrome/common/js/jquery.js"></script><script type="text/javascript" src="/chrome/common/js/babel.js"></script><script type="text/javascript" src="/chrome/common/js/trac.js"></script><script type="text/javascript" src="/chrome/common/js/search.js"></script><script type="text/javascript" src="/chrome/common/js/folding.js"></script><script type="text/javascript" src="/chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="/chrome/common/js/resizer.js"></script><script type="text/javascript" src="/chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 1724, escape_newlines: 1}
        $("#comment").autoPreview("/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="/chrome/site/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://developer.imagej.net/"><img src="http://developer.imagej.net/files/imagej/logo.png" alt="ImageJ Trac" /></a>
      </div>
      <form id="search" action="/search" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="/login">Login</a></li><li><a href="/prefs">Preferences</a></li><li><a href="/wiki/TracGuide">Help/Guide</a></li><li><a href="/about">About Trac</a></li><li class="last"><a href="/reset_password">Forgot your password?</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="/wiki">Wiki</a></li><li><a href="/timeline">Timeline</a></li><li><a href="/roadmap">Roadmap</a></li><li class="active"><a href="/report">View Tickets</a></li><li class="last"><a href="/search">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span id="vote" title="Vote count"><img src="/chrome/vote/aupgray.png" alt="Up-vote" /><span id="votes">+0</span><img src="/chrome/vote/adowngray.png" alt="Down-vote" /></span></li><li><span>&larr; <a class="prev" href="/ticket/1723" title="Ticket #1723">Previous Ticket</a></span></li><li><span><a class="next" href="/ticket/1725" title="Ticket #1725">Next Ticket</a> &rarr;</span></li><li class="last"><a href="/depgraph/1724">Depgraph</a></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="/ticket/1724">Ticket #1724</a>
          <span class="status">(new defect)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="/timeline?from=2013-03-21T13%3A17%3A06-05%3A00&amp;precision=second" title="2013-03-21T13:17:06-05:00 in Timeline">6 years</a> ago</p>
    <p>Last modified <a class="timeline" href="/timeline?from=2013-04-12T13%3A22%3A30-05%3A00&amp;precision=second" title="2013-04-12T13:22:30-05:00 in Timeline">6 years</a> ago</p>
  </div>
  <h2 class="summary searchable">File Revert has limitations</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="/query?status=!closed&amp;reporter=bdezonia">bdezonia</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="/query?status=!closed&amp;owner=bdezonia">bdezonia</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="/query?status=!closed&amp;priority=major">major</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="milestone" href="/milestone/imagej2-unscheduled">imagej2-unscheduled</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="/query?status=!closed&amp;component=Plugins">Plugins</a>
        </td>
        <th id="h_version">
          Version:
        </th>
        <td headers="h_version">
              <a href="/query?status=!closed&amp;version="></a>
        </td>
    </tr><tr>
        <th id="h_severity">
          Severity:
        </th>
        <td headers="h_severity">
              <a href="/query?status=!closed&amp;severity=serious">serious</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby">
        </td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking">
              <a class="new" href="/ticket/1633" title="Fix obviously failing commands">#1633</a>
        </td>
        <th>
        </th>
        <td>
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
File Revert reverts an image to it's original state if and only if it has a file (or maybe URL) as a source. An image created by a plugin cannot revert. Examples of these include opening sample images.<br />
</p>
<p>
I think revert should have different behavior. At least when an image does not have a file as a source we should do an UNDO ALL call. Or rerun the original plugin(?). UNDO ALL needs to wait on undo to be finished and of course it wouldn't necessarily work if the undo history was not big enough to hold all the necessary changes. Some thought is required here.<br />
</p>
<p>
Right now if you try to revert a sample image you get an exception thrown. At the very least we should avoid the exception.<br />
</p>
<p>
java.io.FileNotFoundException:  (No such file or directory)<br />
</p>
<blockquote>
<p>
at java.io.RandomAccessFile.open(Native Method)<br />
at java.io.RandomAccessFile.&lt;init&gt;(RandomAccessFile.java:216)<br />
at ome.scifio.io.NIOFileHandle.&lt;init&gt;(NIOFileHandle.java:130)<br />
at ome.scifio.io.NIOFileHandle.&lt;init&gt;(NIOFileHandle.java:141)<br />
at ome.scifio.io.NIOFileHandle.&lt;init&gt;(NIOFileHandle.java:150)<br />
at ome.scifio.io.Location.getHandle(Location.java:309)<br />
at ome.scifio.io.Location.getHandle(Location.java:280)<br />
at ome.scifio.io.Location.getHandle(Location.java:270)<br />
at ome.scifio.io.Location.checkValidId(Location.java:333)<br />
at loci.common.Location.checkValidId(Location.java:243)<br />
at loci.formats.ImageReader.getReader(ImageReader.java:177)<br />
at loci.formats.ImageReader.setId(ImageReader.java:757)<br />
at loci.formats.ReaderWrapper.setId(ReaderWrapper.java:563)<br />
at loci.formats.ChannelFiller.setId(ChannelFiller.java:263)<br />
at loci.formats.ReaderWrapper.setId(ReaderWrapper.java:563)<br />
at loci.formats.ChannelSeparator.setId(ChannelSeparator.java:274)<br />
at loci.formats.ReaderWrapper.setId(ReaderWrapper.java:563)<br />
at net.imglib2.io.ImgOpener.createReader(ImgOpener.java:497)<br />
at net.imglib2.io.ImgOpener.initializeReader(ImgOpener.java:555)<br />
at net.imglib2.io.ImgOpener.openImg(ImgOpener.java:319)<br />
at net.imglib2.io.ImgOpener.openImg(ImgOpener.java:293)<br />
at net.imglib2.io.ImgOpener.openImg(ImgOpener.java:252)<br />
at imagej.io.DefaultIOService.loadDataset(DefaultIOService.java:117)<br />
at imagej.io.DefaultIOService.revertDataset(DefaultIOService.java:129)<br />
at imagej.core.commands.io.RevertImage.run(RevertImage.java:88)<br />
at imagej.command.CommandModule.run(CommandModule.java:163)<br />
at imagej.module.ModuleRunner.run(ModuleRunner.java:169)<br />
at imagej.module.ModuleRunner.call(ModuleRunner.java:126)<br />
at imagej.module.ModuleRunner.call(ModuleRunner.java:1)<br />
at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)<br />
at java.util.concurrent.FutureTask.run(FutureTask.java:138)<br />
at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:895)<br />
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:918)<br />
at java.lang.Thread.run(Thread.java:680)<br />
</p>
</blockquote>

    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-04-12T13%3A22%3A30-05%3A00&amp;precision=second" title="2013-04-12T13:22:30-05:00 in Timeline">6 years</a> ago by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocking</strong>
        <em>1633</em> added; <em>1563</em> removed
    </li><li>
      <strong>Milestone</strong>
        changed from <em>imagej2-b7-ndim-data</em> to <em>imagej2-unscheduled</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
With commit 2be2b78248ee90292f99acbc11b771c9fdf09159 the exception is now avoided. Pushing the rest of this ticket (the UNDO approach) to a later time.<br />
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="/wiki/TracTickets">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="/ticket/1724?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="/ticket/1724?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="/ticket/1724?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="/chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="/about"><strong>Trac 0.12.2</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the ImageJ project at<br /><a href="http://developer.imagej.net/">http://developer.imagej.net/</a></p>
    </div>
  </body>
</html>