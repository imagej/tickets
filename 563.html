<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  
  <!-- See: http://trac.edgewall.org/wiki/TracInterfaceCustomization -->


  <head>
    <title>
      #563 (Improve how legacy layer handles data that cannot be represented in IJ1)
     â€“ ImageJ
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link rel="search" href="/search" />
        <link rel="prev" href="/ticket/562" title="Ticket #562" />
        <link rel="last" href="/ticket/2043" title="Ticket #2043" />
        <link rel="help" href="/wiki/TracGuide" />
        <link rel="alternate" href="/ticket/563?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="/ticket/563?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="/ticket/563?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="/ticket/564" title="Ticket #564" />
        <link rel="start" href="/wiki" />
        <link rel="stylesheet" href="trac.css" type="text/css" /><link rel="stylesheet" href="ticket.css" type="text/css" /><link rel="stylesheet" href="tracvote.css" type="text/css" />
        <link rel="first" href="/ticket/1" title="Ticket #1" />
        <link rel="shortcut icon" href="/chrome/site/imagej-16.png" type="image/png" />
        <link rel="icon" href="/chrome/site/imagej-16.png" type="image/png" />
      <link type="application/opensearchdescription+xml" rel="search" href="/search/opensearch" title="Search ImageJ" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="fb0b10e3472c32b5691f259d";
    </script>
    <script type="text/javascript" src="/chrome/common/js/jquery.js"></script><script type="text/javascript" src="/chrome/common/js/babel.js"></script><script type="text/javascript" src="/chrome/common/js/trac.js"></script><script type="text/javascript" src="/chrome/common/js/search.js"></script><script type="text/javascript" src="/chrome/common/js/folding.js"></script><script type="text/javascript" src="/chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="/chrome/common/js/resizer.js"></script><script type="text/javascript" src="/chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 563, escape_newlines: 1}
        $("#comment").autoPreview("/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>
  <body>
    <div id="main">
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="/ticket/563">Ticket #563</a>
          <span class="status">(closed defect: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="/timeline?from=2011-06-02T17%3A22%3A01-05%3A00&amp;precision=second" title="2011-06-02T17:22:01-05:00 in Timeline">8 years</a> ago</p>
    <p>Last modified <a class="timeline" href="/timeline?from=2011-10-13T09%3A46%3A42-05%3A00&amp;precision=second" title="2011-10-13T09:46:42-05:00 in Timeline">8 years</a> ago</p>
  </div>
  <h2 class="summary searchable">Improve how legacy layer handles data that cannot be represented in IJ1</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="/query?status=!closed&amp;reporter=bdezonia">bdezonia</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="/query?status=!closed&amp;owner=bdezonia">bdezonia</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="/query?status=!closed&amp;priority=major">major</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="closed milestone" href="/milestone/imagej2-b1-initial">imagej2-b1-initial</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="/query?status=!closed&amp;component=Legacy+Compatibility">Legacy Compatibility</a>
        </td>
        <th id="h_version">
          Version:
        </th>
        <td headers="h_version">
              <a href="/query?status=!closed&amp;version"></a>
        </td>
    </tr><tr>
        <th id="h_severity">
          Severity:
        </th>
        <td headers="h_severity">
              <a href="/query?status=!closed&amp;severity=serious">serious</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby">
        </td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking">
        </td>
        <th>
        </th>
        <td>
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
      <span class="lastmod" title="2011-06-02 22:22:23+00:00">
        (last modified by bdezonia)
        (<a href="/ticket/563?action=diff&amp;version=1">diff</a>)
      </span>
    </h3>
    <div class="searchable">
      <p>
Right now if you pass a Dataset to the legacy layer that has some axis not allowed in ImageJ 1.x (say FREQUENCY or SPECTRUM) an exception is thrown. Start catching exceptions appropriately and not passing these images through the legacy layer. Perhaps do a preregistration check that does not register a Dataset if its incompatible. This includes all exceptions currently thrown in LegacyUtils (dimensions too big, too many planes, unsupported axis, etc.).<br />
</p>

    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2011-06-02T17%3A22%3A23-05%3A00&amp;precision=second" title="2011-06-02T17:22:23-05:00 in Timeline">8 years</a> ago by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Description</strong>
        modified (<a href="/ticket/563?action=diff&amp;version=1">diff</a>)
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2011-07-11T15%3A48%3A06-05%3A00&amp;precision=second" title="2011-07-11T15:48:06-05:00 in Timeline">8 years</a> ago by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
Mostly addressed in f4e5525e0b75fe1adb1677ec1edc9adc80ab2eb1. Calling a plugin with incompatible data now skips running the plugin and Log.warn()'s about the issue. Error messages could be more direct (a message dialog) and more precise (laying out the nature of the problem).<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2011-07-11T15%3A49%3A13-05%3A00&amp;precision=second" title="2011-07-11T15:49:13-05:00 in Timeline">8 years</a> ago by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
Another thing that could now be done: remove all the dimension checking and axis checking code in the LegayUtils class. That code should now be irrelevant.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2011-09-14T10%3A48%3A56-05%3A00&amp;precision=second" title="2011-09-14T10:48:56-05:00 in Timeline">8 years</a> ago by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        changed from <em>imagej-2.0-final</em> to <em>imagej-2.0-beta1</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
After discussions the approach to this problem is changing.<br />
</p>
<p>
Right now if you load a sample image (so IJ2 data shadowed by IJ1 ImagePlus) and add a SPECTRUM axis it fails. This is because IJ1 does not support that kind of axis and the legacy layer does nothing.<br />
</p>
<p>
So two approaches could be taken here. One approach is to still fail to translate to IJ1 but remove the current mapping so that data is not out of sync.<br />
</p>
<p>
Another approach (which sounds better) is to treat each new axis as a set of channels in an ImagePlus. Translation would involve rasterizing and unrasterizing these nonIJ1 axes.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2011-09-14T11%3A24%3A45-05%3A00&amp;precision=second" title="2011-09-14T11:24:45-05:00 in Timeline">8 years</a> ago by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
Implementation detail: legacy layer could maintain a axis map which describes how the IJ2 data axes are represented in the shadow ImagePlus. Then upon plugin return the data can be retranslated into IJ2 as appropriate. Note that plugins could rewrite plane counts etc. so translation back needs to know when to abandon mapping.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2011-10-05T11%3A44%3A22-05%3A00&amp;precision=second" title="2011-10-05T11:44:22-05:00 in Timeline">8 years</a> ago by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
The code to encode axes as channels when necessary is in place.<br />
</p>
<p>
TODO:<br />
</p>
<ul><li>minor: eliminate redundant error checking in LegacyUtils
</li></ul><ul><li>major: make sure incompatible data (dimensions too big) is gracefully handled by LegacyPlugin
</li></ul>
    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2011-10-12T16%3A30%3A16-05%3A00&amp;precision=second" title="2011-10-12T16:30:16-05:00 in Timeline">8 years</a> ago by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
In 2092b07bed3190777c6c23ee6d679ceba6c7960e eliminated redundant error checking<br />
</p>
<p>
TODO - make sure incompatible data (dimensions too big) is gracefully handled by LegacyPlugin<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2011-10-13T09%3A46%3A42-05%3A00&amp;precision=second" title="2011-10-13T09:46:42-05:00 in Timeline">8 years</a> ago by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>closed</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li><li>
      <strong>Summary</strong>
        changed from <em>In the legacy layer gracefully handle passing incompatible data to IJ1</em> to <em>Improve how legacy layer handles data that cannot be represented in IJ1</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Opening remaining part of ticket as new one: <a class="closed ticket" href="/ticket/824" title="defect: Improve error handling by LegacyPlugin when given an incompatible Dataset (closed: fixed)">#824</a><br />
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="/wiki/TracTickets">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="/ticket/563?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="/ticket/563?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="/ticket/563?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="/chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="/about"><strong>Trac 0.12.2</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the ImageJ project at<br /><a href="http://developer.imagej.net/">http://developer.imagej.net/</a></p>
    </div>
  </body>
</html>
