<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  
  <!-- See: http://trac.edgewall.org/wiki/TracInterfaceCustomization -->


  <head>
    <title>
      #486 (Memory Limits Changer)
     – ImageJ
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link rel="stylesheet" href="trac.css" type="text/css" /><link rel="stylesheet" href="ticket.css" type="text/css" /><link rel="stylesheet" href="tracvote.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>
  <body>
    <div id="main">
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="/ticket/486">Ticket #486</a>
          <span class="status">(closed enhancement: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened 2011-05-03T10:53:33-05:00</p>
    <p>Last modified 2012-03-27T09:08:47-05:00</p>
  </div>
  <h2 class="summary searchable">Memory Limits Changer</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="/query?status=!closed&amp;reporter=gharris">gharris</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="/query?status=!closed&amp;owner=bdezonia">bdezonia</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="/query?status=!closed&amp;priority=minor">minor</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="closed milestone" href="/milestone/imagej2-b1-initial">imagej2-b1-initial</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="/query?status=!closed&amp;component=Core">Core</a>
        </td>
        <th id="h_version">
          Version:
        </th>
        <td headers="h_version">
              <a href="/query?status=!closed&amp;version"></a>
        </td>
    </tr><tr>
        <th id="h_severity">
          Severity:
        </th>
        <td headers="h_severity">
              <a href="/query?status=!closed&amp;severity=minor">minor</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
              schindelin@…
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby">
        </td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking">
              <a class="closed" href="/ticket/488" title="Launcher - Memory Limit">#488</a>
        </td>
        <th>
        </th>
        <td>
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
Add API and plugin for changing memory limit<br />
</p>

    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed 2011-05-20T17:07:39-05:00 by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        changed from <em>biweekly-2011: May-09 to May-20</em> to <em>imagej-2.0-beta1</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed 2011-10-18T15:23:02-05:00 by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Owner</strong>
        changed from <em>curtis</em> to <em>dscho</em>
    </li><li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>assigned</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed 2012-02-24T12:51:40-06:00 by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocking</strong>
        <em>488</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed 2012-02-27T14:55:49-06:00 by dscho
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        changed from <em>imagej-2.0-beta1</em> to <em>imagej-2.0-beta2</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Like <a class="closed ticket" href="/ticket/488" title="enhancement: Launcher - Memory Limit (closed: fixed)">#488</a>, bump to beta2<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed 2012-02-27T16:03:11-06:00 by dscho
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>assigned</em> to <em>accepted</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed 2012-03-05T14:56:48-06:00 by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        changed from <em>imagej-2.0-beta2</em> to <em>imagej-2.0-beta1</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Since this ticket blocks <a class="closed ticket" href="/ticket/832" title="enhancement: Integrate the Fiji launcher as new ImageJ2 launcher (closed: fixed)">#832</a>, which is slated for beta1, this ticket must also be slated for beta1 (or earlier). If there is no time for this, create a new ImageJ launcher feature ticket for beta2, remove this ticket from <a class="closed ticket" href="/ticket/832" title="enhancement: Integrate the Fiji launcher as new ImageJ2 launcher (closed: fixed)">#832</a>/<a class="closed ticket" href="/ticket/488" title="enhancement: Launcher - Memory Limit (closed: fixed)">#488</a>, and add it to that new ticket instead.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed 2012-03-12T11:13:35-05:00 by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Owner</strong>
        changed from <em>dscho</em> to <em>bdezonia</em>
    </li><li>
      <strong>Status</strong>
        changed from <em>accepted</em> to <em>assigned</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed 2012-03-12T12:38:14-05:00 by dscho
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Cc</strong>
        <em>schindelin@…</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
The ImageJ launcher (to be integrated into IJ2's code base this week) already interprets the contents of ImageJ.cfg. A typical ImageJ.cfg looks like this:<br />
</p>
<blockquote>
<p>
.<br />
jre\bin\javaw.exe <br />
-Xmx700m -cp ij.jar ij.ImageJ<br />
</p>
</blockquote>
<p>
This file format was invented by the Windows-specific ImageJ1 launcher written in Pascal.<br />
</p>
<p>
The first line is the current directory (may be relative to the ImageJ root directory). This setting is ignored by the ImageJ launcher.<br />
</p>
<p>
The second line is the path to the Java executable. Since we try to runtime-link to the libjvm in ImageJ launcher, we ignore that setting, too.<br />
</p>
<p>
The third line has the Java options. We do interpret these, except the final ij.ImageJ (for obvious reasons).<br />
</p>
<p>
The ImageJ launcher also sets the Java property ij.dir to the absolute path of the ImageJ launcher (which is supposed to live in the ImageJ root directory). Most likely the memory limit UI needs to look at this property. If need be, we should also look for the ij.executable property which is set by the ImageJ launcher to its own absolute path.<br />
</p>
<p>
We cannot just put the memory settings into the Preferences because there is no way to set the JVM's heap settings when the JVM has started already (and the ImageJ launcher cannot access the java.util.Preferences before it started up the JVM, and Sun's JVM implementation does not allow to start two JVMs in the same process, even after shutting the first instance down). Catch 22.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-9">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:9" class="cnum">
      <a href="#comment:9">comment:9</a>
    </span>
                  </span>
                  Changed 2012-03-12T13:07:20-05:00 by curtis
                </h3>
                
    <div class="comment searchable">
      
      <p>
Perhaps now would be a good time to rework the cfg format to be more extensible and self-documenting. We could use a key/value pair scheme, for clarity. Something like:<br />
</p>
<pre class="wiki">[Configuration]
maxheap = 700m
jvmargs = 
</pre><p>
The launcher could look for the '[Configuration]' line or other signature on line one indicating a modern config file. If missing, it would assume the IJ1 format.<br />
</p>
<p>
Dscho, if you like this, let's file a ticket for it. Or if it's too much work, this could wait till beta2.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-10">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:10" class="cnum">
      <a href="#comment:10">comment:10</a>
    </span>
                  </span>
                  Changed 2012-03-12T15:18:21-05:00 by dscho
                </h3>
                
    <div class="comment searchable">
      
      <p>
The problem is backwarts-compatibility, which is the reason why I did not change the format (but chose to ignore some entries instead).<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-11">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:11" class="cnum">
      <a href="#comment:11">comment:11</a>
    </span>
                  </span>
                  Changed 2012-03-12T15:27:49-05:00 by curtis
                </h3>
                
    <div class="comment searchable">
      
      <p>
Exactly, I agree. If we want to update the format, we should add in a versioning scheme. So I will refine my earlier proposal just a bit:<br />
</p>
<pre class="wiki"># ImageJ 2.0.0 configuration file, written 2012-03-12 15:27:43
maxheap = 700m
jvmargs =
</pre><p>
Then we check whether the first line starts with a hash with the version code, and if not, we assume it's the old ImageJ1 format. Backwards compatibility preserved!<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-12">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:12" class="cnum">
      <a href="#comment:12">comment:12</a>
    </span>
                  </span>
                  Changed 2012-03-21T14:53:57-05:00 by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
In 0ff1796b2d0b4b906778069c09170b96abfd981e initial implementation in place. Note that there are some TODOs but basic functionality is in place to allow user to edit memory values in the OptionsMemoryAndThreads dialog and have those changes updated in a new launcher config file format.<br />
</p>
<p>
TODO<br />
</p>
<ul><li>Break private LauncherParams class out of OptionsMemoryAndThreads. It should be accessible to the launcher class and I'll wait until that integration into IJ12 is done
</li><li>There is a method called getCfgFileName() that needs to be updated to find the correct location for the ImageJ.cfg file. This info should come from launcher. Right now I don't have that info. The prefs ij.dir and ij.executable don't exist at runtime at the moment.
</li></ul>
    </div>

              </div>
              <div class="change" id="trac-change-13">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:13" class="cnum">
      <a href="#comment:13">comment:13</a>
    </span>
                  </span>
                  Changed 2012-03-23T14:40:15-05:00 by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
In b39be87e309e1f7bbbf591fd3c214a73bec384aa Curtis updated getCfgFileName(). All that is left is to break the private class out to some other location.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-14">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:14" class="cnum">
      <a href="#comment:14">comment:14</a>
    </span>
                  </span>
                  Changed 2012-03-23T16:02:35-05:00 by curtis
                </h3>
                
    <div class="comment searchable">
      
      <p>
Let's also file a separate ticket for updating the configuration file format, as I described above.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-15">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:15" class="cnum">
      <a href="#comment:15">comment:15</a>
    </span>
                  </span>
                  Changed 2012-03-26T14:58:44-05:00 by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
Launcher config file ticket hatched: <a class="closed ticket" href="/ticket/1079" title="defect: Update launcher configuration file format (closed: fixed)">#1079</a><br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-16">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:16" class="cnum">
      <a href="#comment:16">comment:16</a>
    </span>
                  </span>
                  Changed 2012-03-26T16:30:20-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>assigned</em> to <em>closed</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Private class broken out and put in core with commit 1997978287c8fb2880964574b8a2b6816c6e46d9<br />
</p>

    </div>

                <div class="trac-lastedit ">
                  Last edited 2012-03-27T09:06:47-05:00
                      by bdezonia
                </div>
              </div>
              <div class="change" id="trac-change-17">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:17" class="cnum">
      <a href="#comment:17">comment:17</a>
    </span>
                  </span>
                  Changed 2012-03-27T09:08:47-05:00 by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
In e358f12ffac58d203d7ed655bcba51b4f869d95b updated code so that it only writes an ImageJ.cfg file when the user changes values of the parameters (via OptionsMemoryAndThreads or by calling setMemoryInMB() or setJvmArgs() on a constructed ConfigFileParameters object).<br />
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="/wiki/TracTickets">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="/ticket/486?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="/ticket/486?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="/ticket/486?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="/chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="/about"><strong>Trac 0.12.2</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the ImageJ project at<br /><a href="http://developer.imagej.net/">http://developer.imagej.net/</a></p>
    </div>
  </body>
</html>
