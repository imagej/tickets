<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  
  <!-- See: http://trac.edgewall.org/wiki/TracInterfaceCustomization -->


  <head>
    <title>
      #1451 (Consolidate options, prefs and config logic)
     – ImageJ
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link rel="stylesheet" href="trac.css" type="text/css" /><link rel="stylesheet" href="ticket.css" type="text/css" /><link rel="stylesheet" href="tracvote.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>
  <body>
    <div id="main">
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="/ticket/1451">Ticket #1451</a>
          <span class="status">(closed task: moved)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened 2012-08-30T14:02:17-05:00</p>
    <p>Last modified 2014-07-18T13:41:33-05:00</p>
  </div>
  <h2 class="summary searchable">Consolidate options, prefs and config logic</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        curtis
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        curtis
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              minor
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              imagej-2.0.0
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              Core
        </td>
        <th id="h_version">
          Version:
        </th>
        <td headers="h_version">
              
        </td>
    </tr><tr>
        <th id="h_severity">
          Severity:
        </th>
        <td headers="h_severity">
              non-issue
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby">
              <a class="closed" href="/ticket/1706" title="Preferences for Multiple Instances, Applications, and Versions">#1706</a>
        </td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking">
              <a class="new" href="/ticket/1400" title="Recommended architecture changes (2.0.0-final)">#1400</a>
        </td>
        <th>
        </th>
        <td>
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
Currently, we have a package imagej.options with an OptionsService, as well as a separate imagej.config package with a ConfigFileParameters class for working with the ImageJ.cfg launcher file. We also have imagej.util.Prefs for managing persistence of key/value string pairs.<br />
</p>
<p>
We should strongly consider consolidation of all these, eliminating any redundant concepts.<br />
</p>

    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed 2012-09-06T16:17:01-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>490</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed 2012-09-06T16:17:26-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>564</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed 2012-09-06T16:17:43-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>612</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed 2012-09-06T16:18:07-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>790</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed 2012-09-06T16:18:31-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>903</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed 2012-09-06T16:18:59-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>904</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed 2012-09-06T16:19:14-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>960</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed 2012-09-06T16:19:28-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>962</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-9">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:9" class="cnum">
      <a href="#comment:9">comment:9</a>
    </span>
                  </span>
                  Changed 2012-09-06T16:19:51-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>980</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-10">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:10" class="cnum">
      <a href="#comment:10">comment:10</a>
    </span>
                  </span>
                  Changed 2012-09-06T16:20:17-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>982</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-11">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:11" class="cnum">
      <a href="#comment:11">comment:11</a>
    </span>
                  </span>
                  Changed 2012-09-06T16:20:41-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>1266</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-12">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:12" class="cnum">
      <a href="#comment:12">comment:12</a>
    </span>
                  </span>
                  Changed 2012-09-06T16:22:33-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>490</em> removed
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-13">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:13" class="cnum">
      <a href="#comment:13">comment:13</a>
    </span>
                  </span>
                  Changed 2012-09-06T16:22:56-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>564</em> removed
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-14">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:14" class="cnum">
      <a href="#comment:14">comment:14</a>
    </span>
                  </span>
                  Changed 2012-09-06T16:23:16-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>612</em> removed
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-15">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:15" class="cnum">
      <a href="#comment:15">comment:15</a>
    </span>
                  </span>
                  Changed 2012-09-06T16:23:41-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>790</em> removed
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-16">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:16" class="cnum">
      <a href="#comment:16">comment:16</a>
    </span>
                  </span>
                  Changed 2012-09-06T16:24:03-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>903</em> removed
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-17">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:17" class="cnum">
      <a href="#comment:17">comment:17</a>
    </span>
                  </span>
                  Changed 2012-09-06T16:24:22-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>904</em> removed
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-18">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:18" class="cnum">
      <a href="#comment:18">comment:18</a>
    </span>
                  </span>
                  Changed 2012-09-06T16:24:37-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>960</em> removed
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-19">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:19" class="cnum">
      <a href="#comment:19">comment:19</a>
    </span>
                  </span>
                  Changed 2012-09-06T16:24:58-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>962</em> removed
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-20">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:20" class="cnum">
      <a href="#comment:20">comment:20</a>
    </span>
                  </span>
                  Changed 2012-09-06T16:25:20-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>980</em> removed
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-21">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:21" class="cnum">
      <a href="#comment:21">comment:21</a>
    </span>
                  </span>
                  Changed 2012-09-06T16:25:49-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>982</em> removed
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-22">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:22" class="cnum">
      <a href="#comment:22">comment:22</a>
    </span>
                  </span>
                  Changed 2012-09-06T16:26:05-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>1266</em> removed
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-23">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:23" class="cnum">
      <a href="#comment:23">comment:23</a>
    </span>
                  </span>
                  Changed 2013-03-21T11:47:12-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocking</strong>
        <em>1400</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-24">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:24" class="cnum">
      <a href="#comment:24">comment:24</a>
    </span>
                  </span>
                  Changed 2013-03-21T13:38:34-05:00 by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>1706</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
(In <a class="closed ticket" href="/ticket/1706" title="enhancement: Preferences for Multiple Instances, Applications, and Versions (closed: moved)">#1706</a>) Firstly, note that the preferences are loaded and saved as part of the preprocessing chain during command execution. The relevant preprocessors are:<br />
</p>
<ul><li><a class="ext-link" href="https://github.com/imagej/imagej/blob/v2.0.0-beta6/core/core/src/main/java/imagej/plugin/LoadInputsPreprocessor.java"><span class="icon"> </span>LoadInputsPreprocessor</a>
</li><li><a class="ext-link" href="https://github.com/imagej/imagej/blob/v2.0.0-beta6/core/core/src/main/java/imagej/plugin/SaveInputsPreprocessor.java"><span class="icon"> </span>SaveInputsPreprocessor</a>
</li></ul><p>
And the actual saving and loading code for module items is unfortunately <a class="ext-link" href="https://github.com/imagej/imagej/blob/v2.0.0-beta6/core/core/src/main/java/imagej/module/AbstractModuleItem.java#L132"><span class="icon"> </span>hardcoded</a> right now.<br />
</p>
<p>
From my perspective, it is clear from your comments that this logic should be refactored into its own service class as part of the ticket <a class="closed ticket" href="/ticket/1451" title="task: Consolidate options, prefs and config logic (closed: moved)">#1451</a> work. That way, any future deficiencies in the persistence mechanism could be fixed downstream by using an alternate service implementation.<br />
</p>
<blockquote class="citation">
<p>
When an application launches, if it does not find a node for itself, it could optionally copy or translate the values from an old version node<br />
</p>
</blockquote>
<p>
Yes, it would need to copy the values from the next level up the tree. And when persisting the values, it would need to store them to its node, as well as higher level nodes ("stomping on" the previous values) for the benefit of future contexts. This scheme would allow concurrent contexts to keep separate track of preferences, avoiding some concurrency issues at the expense of increased complexity. (E.g., some people might be surprised or confused when different contexts retrieve different persisted values from what they might assume would be a common storage mechanism.)<br />
</p>
<p>
Another concern I have is what to use for the context identifiers. If we use positive increasing ID numbers, when a context first starts up in a fresh JVM it might inherit the persisted values from the previous JVM's context(s), assuming we start again from "1" each time. Or we could persist the last-used context ID, and have an always-incrementing long, which would ensure each context has a nearly-eternally-unique ID, but then the persisted preferences would become major cruft over time. Alternately, rather than using the Preferences API for context-specific preferences, we could store them in a data structure of the service rather than on disk via the Preferences API, which would be my tentative preference.<br />
</p>
<p>
Thoughts?<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-25">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:25" class="cnum">
      <a href="#comment:25">comment:25</a>
    </span>
                  </span>
                  Changed 2014-07-18T13:41:33-05:00 by hinerm
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>closed</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>moved</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Moved to github: <a class="ext-link" href="https://github.com/imagej/imagej/issues/95"><span class="icon"> </span>https://github.com/imagej/imagej/issues/95</a><br />
</p>

    </div>

              </div>
          </div>
        </div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="/ticket/1451?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="/ticket/1451?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="/ticket/1451?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="/chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="/about"><strong>Trac 0.12.2</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the ImageJ project at<br /><a href="http://developer.imagej.net/">http://developer.imagej.net/</a></p>
    </div>
  </body>
</html>
