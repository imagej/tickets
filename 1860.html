<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  
  <!-- See: http://trac.edgewall.org/wiki/TracInterfaceCustomization -->


  <head>
    <title>
      #1860 (Add a Jenkins job for monitoring the disk usage on http://sites.imagej.net/)
     – ImageJ
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link rel="stylesheet" href="trac.css" type="text/css" /><link rel="stylesheet" href="ticket.css" type="text/css" /><link rel="stylesheet" href="tracvote.css" type="text/css" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="9e949ad4f8cd29cb77a3b965";
    </script>
    <script type="text/javascript" src="/chrome/common/js/jquery.js"></script><script type="text/javascript" src="/chrome/common/js/babel.js"></script><script type="text/javascript" src="/chrome/common/js/trac.js"></script><script type="text/javascript" src="/chrome/common/js/search.js"></script><script type="text/javascript" src="/chrome/common/js/folding.js"></script><script type="text/javascript" src="/chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="/chrome/common/js/resizer.js"></script><script type="text/javascript" src="/chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 1860, escape_newlines: 1}
        $("#comment").autoPreview("/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>
  <body>
    <div id="main">
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="/ticket/1860">Ticket #1860</a>
          <span class="status">(closed enhancement: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="/timeline?from=2013-05-10T12%3A58%3A46-05%3A00&amp;precision=second" title="2013-05-10T12:58:46-05:00 in Timeline">6 years</a> ago</p>
    <p>Last modified <a class="timeline" href="/timeline?from=2013-05-31T16%3A16%3A40-05%3A00&amp;precision=second" title="2013-05-31T16:16:40-05:00 in Timeline">6 years</a> ago</p>
  </div>
  <h2 class="summary searchable">Add a Jenkins job for monitoring the disk usage on http://sites.imagej.net/</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="/query?status=!closed&amp;reporter=dscho">dscho</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="/query?status=!closed&amp;owner=dscho">dscho</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="/query?status=!closed&amp;priority=major">major</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="closed milestone" href="/milestone/imagej2-b7-ndim-data">imagej2-b7-ndim-data</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="/query?status=!closed&amp;component=Server+Admin">Server Admin</a>
        </td>
        <th id="h_version">
          Version:
        </th>
        <td headers="h_version">
              <a href="/query?status=!closed&amp;version="></a>
        </td>
    </tr><tr>
        <th id="h_severity">
          Severity:
        </th>
        <td headers="h_severity">
              <a href="/query?status=!closed&amp;severity=serious">serious</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
              <a href="/query?status=!closed&amp;cc=~curtis">curtis</a>
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby">
              <a class="closed" href="/ticket/1862" title="Make skynet a restricted Jenkins node">#1862</a>
        </td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking">
              <a class="closed" href="/ticket/1857" title="Feature: sites.imagej.net">#1857</a>
        </td>
        <th>
        </th>
        <td>
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
For the moment, sites.imagej.net shares disk space with openspim.org, and in any case, users of sites.imagej.net will share disk space with each other. To prevent abuse (and thereby denying other users the space), let's monitor the disk usage using Jenkins.<br />
</p>

    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-05-10T12%3A59%3A59-05%3A00&amp;precision=second" title="2013-05-10T12:59:59-05:00 in Timeline">6 years</a> ago by dscho
                </h3>
                
    <div class="comment searchable">
      
      <p>
My original plan was to do it via quotas, but quotas are only per-user and per-filesystem, not per-directory. Since the same "user" (i.e. <em>www-data</em>) owns all the files, quotas are pretty useless here.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-05-10T15%3A00%3A10-05%3A00&amp;precision=second" title="2013-05-10T15:00:10-05:00 in Timeline">6 years</a> ago by dscho
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>1862</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-05-12T10%3A16%3A22-05%3A00&amp;precision=second" title="2013-05-12T10:16:22-05:00 in Timeline">6 years</a> ago by dscho
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>closed</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
This job is now in place: <a class="ext-link" href="http://jenkins.imagej.net/job/Monitor-sites.imagej.net/"><span class="icon"> </span>http://jenkins.imagej.net/job/Monitor-sites.imagej.net/</a><br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-05-12T10%3A35%3A32-05%3A00&amp;precision=second" title="2013-05-12T10:35:32-05:00 in Timeline">6 years</a> ago by dscho
                </h3>
                
    <div class="comment searchable">
      
      <p>
Forgot to mention: to be able to mark the build as unstable when a soft quota is reached, or when unexpected files were found, I also copied jenkins-cli.jar into ~jenkins/bin/ and added a private key.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-05-13T09%3A59%3A28-05%3A00&amp;precision=second" title="2013-05-13T09:59:28-05:00 in Timeline">6 years</a> ago by curtis
                </h3>
                
    <div class="comment searchable">
      
      <p>
So if I understand correctly, Jenkins is running a script which calls jenkins-cli to change Jenkins state? Wouldn't it be simpler to use Groovy postbuild to set the build to unstable that way?<br />
</p>
<p>
(I took a very quick look at the job to find out the answer for myself, but it is quite complex, with a long shell script embedded in the job, so I am punting with this comment instead.)<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-05-13T11%3A09%3A55-05%3A00&amp;precision=second" title="2013-05-13T11:09:55-05:00 in Timeline">6 years</a> ago by dscho
                </h3>
                
    <div class="comment searchable">
      
      <p>
Jenkins runs the shell script on the node (and thus has easy access to the files generated by said script), but runs the postbuild on the master (which does not).<br />
</p>
<p>
Actually, in our case, I archive the files so the postbuild *could* access the files and read them and analyze them, but I think doing that would be more fragile (and also would require more code to begin with, as shell is *still* more expressive than Groovy).<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-05-13T11%3A12%3A55-05%3A00&amp;precision=second" title="2013-05-13T11:12:55-05:00 in Timeline">6 years</a> ago by curtis
                </h3>
                
    <div class="comment searchable">
      
      <p>
OK, thanks, that makes sense. The current approach sounds fine then. Another possibility would be to change the shell script to do the analysis, but rather than using jenkins-cli to mark the build as unstable, instead write out a file RESULT with e.g. "Success" or "Unstable" or "Failure" as its contents, then have the Groovy postbuild use that to decide. But I don't feel strongly about it.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-05-31T16%3A16%3A40-05%3A00&amp;precision=second" title="2013-05-31T16:16:40-05:00 in Timeline">6 years</a> ago by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        changed from <em>imagej2-b8-analysis</em> to <em>imagej2-b7-ndim-data</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="/wiki/TracTickets">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="/ticket/1860?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="/ticket/1860?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="/ticket/1860?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="/chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="/about"><strong>Trac 0.12.2</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the ImageJ project at<br /><a href="http://developer.imagej.net/">http://developer.imagej.net/</a></p>
    </div>
  </body>
</html>
