<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  
  <!-- See: http://trac.edgewall.org/wiki/TracInterfaceCustomization -->


  <head>
    <title>
      #1641 (Bypassing pre and post processors problematic)
     – ImageJ
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link rel="search" href="/search" />
        <link rel="prev" href="/ticket/1640" title="Ticket #1640" />
        <link rel="last" href="/ticket/2043" title="Ticket #2043" />
        <link rel="help" href="/wiki/TracGuide" />
        <link rel="alternate" href="/ticket/1641?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="/ticket/1641?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="/ticket/1641?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="/ticket/1642" title="Ticket #1642" />
        <link rel="start" href="/wiki" />
        <link rel="stylesheet" href="/chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="/chrome/common/css/ticket.css" type="text/css" /><link rel="stylesheet" href="/chrome/vote/css/tracvote.css" type="text/css" />
        <link rel="first" href="/ticket/1" title="Ticket #1" />
        <link rel="shortcut icon" href="/chrome/site/imagej-16.png" type="image/png" />
        <link rel="icon" href="/chrome/site/imagej-16.png" type="image/png" />
      <link type="application/opensearchdescription+xml" rel="search" href="/search/opensearch" title="Search ImageJ" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="d606eaa37366fc0ef7fb16af";
    </script>
    <script type="text/javascript" src="/chrome/common/js/jquery.js"></script><script type="text/javascript" src="/chrome/common/js/babel.js"></script><script type="text/javascript" src="/chrome/common/js/trac.js"></script><script type="text/javascript" src="/chrome/common/js/search.js"></script><script type="text/javascript" src="/chrome/common/js/folding.js"></script><script type="text/javascript" src="/chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="/chrome/common/js/resizer.js"></script><script type="text/javascript" src="/chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 1641, escape_newlines: 1}
        $("#comment").autoPreview("/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="/chrome/site/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://developer.imagej.net/"><img src="http://developer.imagej.net/files/imagej/logo.png" alt="ImageJ Trac" /></a>
      </div>
      <form id="search" action="/search" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="/login">Login</a></li><li><a href="/prefs">Preferences</a></li><li><a href="/wiki/TracGuide">Help/Guide</a></li><li><a href="/about">About Trac</a></li><li class="last"><a href="/reset_password">Forgot your password?</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="/wiki">Wiki</a></li><li><a href="/timeline">Timeline</a></li><li><a href="/roadmap">Roadmap</a></li><li class="active"><a href="/report">View Tickets</a></li><li class="last"><a href="/search">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span id="vote" title="Vote count"><img src="/chrome/vote/aupgray.png" alt="Up-vote" /><span id="votes">+0</span><img src="/chrome/vote/adowngray.png" alt="Down-vote" /></span></li><li><span>&larr; <a class="prev" href="/ticket/1640" title="Ticket #1640">Previous Ticket</a></span></li><li><span><a class="next" href="/ticket/1642" title="Ticket #1642">Next Ticket</a> &rarr;</span></li><li class="last"><a href="/depgraph/1641">Depgraph</a></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="/ticket/1641">Ticket #1641</a>
          <span class="status">(closed defect: wontfix)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="/timeline?from=2013-01-29T17%3A17%3A20-06%3A00&amp;precision=second" title="2013-01-29T17:17:20-06:00 in Timeline">6 years</a> ago</p>
    <p>Last modified <a class="timeline" href="/timeline?from=2014-05-01T05%3A56%3A24-05%3A00&amp;precision=second" title="2014-05-01T05:56:24-05:00 in Timeline">5 years</a> ago</p>
  </div>
  <h2 class="summary searchable">Bypassing pre and post processors problematic</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="/query?status=!closed&amp;reporter=bdezonia">bdezonia</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="/query?status=!closed&amp;owner=curtis">curtis</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="/query?status=!closed&amp;priority=major">major</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="milestone" href="/milestone/imagej2-b10-compatibility">imagej2-b10-compatibility</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="/query?status=!closed&amp;component=Plugin+Framework">Plugin Framework</a>
        </td>
        <th id="h_version">
          Version:
        </th>
        <td headers="h_version">
              <a href="/query?status=!closed&amp;version="></a>
        </td>
    </tr><tr>
        <th id="h_severity">
          Severity:
        </th>
        <td headers="h_severity">
              <a href="/query?status=!closed&amp;severity=serious">serious</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby">
        </td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking">
              <a class="closed" href="/ticket/1696" title="Improve plugin infrastructure [compatibility]">#1696</a>
        </td>
        <th>
        </th>
        <td>
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
ImageJ2 supports multiple methods of Command invokation. One supported method is by direct Java calls bypassing the command services. This method bypasses pre and post processors. Unfortunately one of the preprocessors is the InitPreprocessor which is responsible for initializing Commands with annotated initializers. These Commands do not get initialized correctly.<br />
</p>
<p>
Ideally we would be able to always run initializers when the api user calls some method of Command. An initial approach would be in setContext() (of both ContextCommand and DynamicCommand).  However ctrueden sees a double initialization issue here.<br />
</p>

    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-01-29T17%3A20%3A14-06%3A00&amp;precision=second" title="2013-01-29T17:20:14-06:00 in Timeline">6 years</a> ago by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
Note that I discovered this issue by converting NewImage plugin to a DynamicCommand from a ContextCommand. The code in InvokeCommandTest had to be recompiled and after the change  running the plugin would cause a NPE. I hacked the initialization code in NewImage to avoid this case (and documented well what was being done). If we fix this bug in a general way we should cleanup NewImage a little and make sure to test that InvokeCommandTest works.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-01-30T14%3A09%3A15-06%3A00&amp;precision=second" title="2013-01-30T14:09:15-06:00 in Timeline">6 years</a> ago by curtis
                </h3>
                
    <div class="comment searchable">
      
      <p>
The real difficulty is that <tt>InitPreprocessor</tt> is not the only desirable preprocessor that someone may want to execute on their command, prior to running it. In particular, many initialization methods require other parameters to have been populated earlier in the chain: Services in particular, but also Datasets, DatasetViews and ImageDisplays, via the <tt>ActiveDisplayPreprocessor</tt> and <tt>ActiveImagePreprocessor</tt>. There is also a <tt>UIPreprocessor</tt> that populates <tt>UserInterface</tt> inputs, and other similar preprocessors could exist for other sorts of inputs—ImageJ2's extensibility makes this very possible.<br />
</p>
<p>
Intuitively, it seems to me that a suitable subset of the preprocessors need to be flagged somehow for execution in the programmatic context. In other words, we should get rid of the hack in ContextCommand#setContext(ImageJ) which calls CommandService#populateServices(ContextCommand), and instead have a CommandService#selectivePreprocess or some such, that applies only those preprocessors matching the suitability criteria. This could be as simple as a boolean flag of the @Plugin annotation, or we could have some other way of deciding.<br />
</p>
<p>
Another issue is whether such preprocessing should fire any events. Our current approach with populating the services is not to do so, but it seems strange to apply an extensible set of suitable preprocessors without telling anyone about it.<br />
</p>
<p>
Thoughts?<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-03-07T13%3A25%3A31-06%3A00&amp;precision=second" title="2013-03-07T13:25:31-06:00 in Timeline">6 years</a> ago by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Priority</strong>
        changed from <em>major</em> to <em>review</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-03-07T13%3A50%3A28-06%3A00&amp;precision=second" title="2013-03-07T13:50:28-06:00 in Timeline">6 years</a> ago by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Priority</strong>
        changed from <em>review</em> to <em>major</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-03-07T15%3A02%3A25-06%3A00&amp;precision=second" title="2013-03-07T15:02:25-06:00 in Timeline">6 years</a> ago by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Owner</strong>
        changed from <em>curtis</em> to <em>bdezonia</em>
    </li><li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>reviewing</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-03-19T10%3A50%3A02-05%3A00&amp;precision=second" title="2013-03-19T10:50:02-05:00 in Timeline">6 years</a> ago by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Owner</strong>
        changed from <em>bdezonia</em> to <em>curtis</em>
    </li><li>
      <strong>Status</strong>
        changed from <em>reviewing</em> to <em>accepted</em>
    </li><li>
      <strong>Milestone</strong>
        changed from <em>imagej2-b7-ndim-data</em> to <em>imagej2-b10-compatibility</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-03-19T11%3A04%3A26-05%3A00&amp;precision=second" title="2013-03-19T11:04:26-05:00 in Timeline">6 years</a> ago by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Component</strong>
        changed from <em>Core</em> to <em>Plugin Framework</em>
    </li><li>
      <strong>Blocking</strong>
        <em>1696</em> added; <em>1357</em> removed
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-07-10T13%3A19%3A29-05%3A00&amp;precision=second" title="2013-07-10T13:19:29-05:00 in Timeline">6 years</a> ago by curtis
                </h3>
                
    <div class="comment searchable">
      
      <p>
Note that <tt>InvokeCommandTest</tt> has been removed in favor of an ImageJ tutorial showing how to execute commands (which now uses <tt>OpenFile</tt> for simplicity and to avoid this issue). However, this issue still needs to be fixed.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-9">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:9" class="cnum">
      <a href="#comment:9">comment:9</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2014-05-01T05%3A56%3A24-05%3A00&amp;precision=second" title="2014-05-01T05:56:24-05:00 in Timeline">5 years</a> ago by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>accepted</em> to <em>closed</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>wontfix</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
A <a class="ext-link" href="http://imagej.net/pipermail/imagej-devel/2014-April/002020.html"><span class="icon"> </span>recent thread on imagej-devel</a> touched on many related issues, including the initialization of modules. We concluded that for use cases where the pre- and post-processing steps are omitted, it is the responsibility of the caller to call <tt>initialize</tt> manually before executing the module. This greatly simplifies matters, because I see no general way of ensuring that <tt>initialize</tt> gets called by the module framework when the framework itself is being largely bypassed.<br />
</p>

    </div>

                <div class="trac-lastedit ">
                  Last edited <a class="timeline" href="/timeline?from=2014-05-01T05%3A56%3A46-05%3A00&amp;precision=second" title="2014-05-01T05:56:46-05:00 in Timeline">5 years</a> ago
                      by curtis
                    (<a href="/ticket/1641?cversion=0&amp;cnum_hist=9#comment:9">previous</a>)
                    (<a href="/ticket/1641?action=comment-diff&amp;cnum=9&amp;version=1">diff</a>)
                </div>
              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="/wiki/TracTickets">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="/ticket/1641?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="/ticket/1641?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="/ticket/1641?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="/chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="/about"><strong>Trac 0.12.2</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the ImageJ project at<br /><a href="http://developer.imagej.net/">http://developer.imagej.net/</a></p>
    </div>
  </body>
</html>