<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  
  <!-- See: http://trac.edgewall.org/wiki/TracInterfaceCustomization -->


  <head>
    <title>
      #1367 (Minimize the number of images that get opened by the legacy layer)
     – ImageJ
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link rel="stylesheet" href="trac.css" type="text/css" /><link rel="stylesheet" href="ticket.css" type="text/css" /><link rel="stylesheet" href="tracvote.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>
  <body>
    <div id="main">
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="/ticket/1367">Ticket #1367</a>
          <span class="status">(closed defect: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened 2012-08-03T14:10:11-05:00</p>
    <p>Last modified 2012-08-14T10:53:23-05:00</p>
  </div>
  <h2 class="summary searchable">Minimize the number of images that get opened by the legacy layer</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        bdezonia
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        bdezonia
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              major
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="closed milestone" href="/milestone/imagej2-b4-plugins">imagej2-b4-plugins</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              Legacy Compatibility
        </td>
        <th id="h_version">
          Version:
        </th>
        <td headers="h_version">
              
        </td>
    </tr><tr>
        <th id="h_severity">
          Severity:
        </th>
        <td headers="h_severity">
              serious
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
              G.Landini@…
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby">
        </td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking">
              <a class="new" href="/ticket/1170" title="Improve performance">#1170</a>, <a class="closed" href="/ticket/1331" title="Update legacy layer to fix some plugin incompatibilities [plugins]">#1331</a>
        </td>
        <th>
        </th>
        <td>
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
Between beta 3 and beta 4 in the ij2 developer mailing list Gabriel Landini reported:<br />
</p>
<p>
Not sure if this has been flagged before.<br />
When running an IJ1 plugin that creates an ImagePlus but it is not shown, the<br />
same plugin in IJ2 shows the image.<br />
</p>
<p>
Is this something that can be resolved? If not, it might be impossible or<br />
painfully slow to run IJ1 plugins that create a large number of temporary<br />
ImagePlus but are not shown to be processed and then closed. In IJ2 they are<br />
all shown making the whole process very slow.<br />
</p>

    </div>
  </div>
</div>
          
    <div id="attachments">
        <h2 class="foldable">Attachments</h2>
        <div>
          <dl class="attachments">
              <dt>
    <a href="/attachment/ticket/1367/BinaryReconstruct_.java" title="View attachment">BinaryReconstruct_.java</a>
      <a href="/raw-attachment/ticket/1367/BinaryReconstruct_.java" class="trac-rawlink" title="Download"><img src="/chrome/common/download.png" alt="Download" /></a>
       (<span title="7549 bytes">7.4 KB</span>) -
      added by <em>bdezonia</em> 2012-08-13T16:54:28-05:00.
  </dt>
              <dd>
                First of two plugins needed to recreate issue
              </dd>
              <dt>
    <a href="/attachment/ticket/1367/GreyscaleReconstruct_.java" title="View attachment">GreyscaleReconstruct_.java</a>
      <a href="/raw-attachment/ticket/1367/GreyscaleReconstruct_.java" class="trac-rawlink" title="Download"><img src="/chrome/common/download.png" alt="Download" /></a>
       (<span title="6733 bytes">6.6 KB</span>) -
      added by <em>bdezonia</em> 2012-08-13T16:54:53-05:00.
  </dt>
              <dd>
                Second of two plugins needed to recreate problem
              </dd>
          </dl>
          
        </div>
    </div>

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed 2012-08-07T10:27:51-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocking</strong>
        <em>1170</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed 2012-08-08T11:41:38-05:00 by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        changed from <em>imagej-2.0.0-beta5</em> to <em>imagej-2.0.0-beta4</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
This ticket must target beta4 as long as it blocks <a class="new ticket" href="/ticket/1170" title="feature: Improve performance (new)">#1170</a>.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed 2012-08-13T12:42:43-05:00 by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
With commit 2ebd06347ff4412d8274b0fbf52b778d2e598f09 I have optimized ImagePlus tracking to skip those ImagePluses that do not have windows or ImageProcessors associated with them.<br />
</p>
<p>
Gabriel, please test and let me know if its fixed. Thanks.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed 2012-08-13T12:46:46-05:00 by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
Note that the change was to more closely mirror IJ1's behavior in regards to updateAndDraw() and repaintWindow() methods. When ImagePluses have no ImageProcessor set or have no associated window IJ1 does not do anything.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed 2012-08-13T13:14:56-05:00 by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
With commit 095765ebb7d5dbc1006d42616c3b8ec0402071fb further optimization in place.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed 2012-08-13T13:55:26-05:00 by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
Finalized closing behavior with commit 6244fc0da522e30f82b40a2e7b3a6959546c61d2<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed 2012-08-13T15:54:38-05:00 by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
Gabriel, I've figured out how to replicate your issue with those plugins. My previous fix was insufficient. I'll debug further.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed 2012-08-13T16:52:34-05:00 by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
With commit ddb0441c65f7366e0288f472528e42cd4d3c73e3 the repeated creation of windows has been dispatched. Additional testing required but looks good so far.<br />
</p>
<p>
Gabriel, I think it is now fixed.<br />
</p>

    </div>

              </div>
              <div class="change">
                <h3 class="change">
                  Changed 2012-08-13T16:54:28-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>attachment</strong>
        <a href="/attachment/ticket/1367/BinaryReconstruct_.java"><em>BinaryReconstruct_.java</em></a>
          <a href="/raw-attachment/ticket/1367/BinaryReconstruct_.java" title="Download" class="trac-rawlink"><img src="/chrome/common/download.png" alt="Download" /></a>
          added
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
First of two plugins needed to recreate issue<br />
</p>

    </div>

              </div>
              <div class="change">
                <h3 class="change">
                  Changed 2012-08-13T16:54:53-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>attachment</strong>
        <a href="/attachment/ticket/1367/GreyscaleReconstruct_.java"><em>GreyscaleReconstruct_.java</em></a>
          <a href="/raw-attachment/ticket/1367/GreyscaleReconstruct_.java" title="Download" class="trac-rawlink"><img src="/chrome/common/download.png" alt="Download" /></a>
          added
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Second of two plugins needed to recreate problem<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-9">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:9" class="cnum">
      <a href="#comment:9">comment:9</a>
    </span>
                  </span>
                  Changed 2012-08-13T16:57:12-05:00 by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
To duplicate issue run GreyscaleReconstruct which itself calls BinaryReconstruct. First create a binary mask and open particles for binary test image. Run the plugin. On IJ1 it works and only ever opens one image. On IJ2 prefix it opened images until memory exhausted. With fix this is no longer the case.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-10">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:10" class="cnum">
      <a href="#comment:10">comment:10</a>
    </span>
                          <span>follow-up:</span>
      <a href="#comment:11">↓ 11</a>
                  </span>
                  Changed 2012-08-13T16:57:19-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>closed</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-11">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:11" class="cnum">
      <a href="#comment:11">comment:11</a>
    </span>
                        in reply to:
      <a href="#comment:10">↑ 10</a>
                  </span>
                  Changed 2012-08-14T04:45:27-05:00 by landinig
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>closed</em> to <em>reopened</em>
    </li><li>
      <strong>Resolution</strong>
        <em>fixed</em> deleted
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Replying to <a href="/ticket/1367#comment:10" title="Comment 10 for Ticket #1367">bdezonia</a>:<br />
</p>
<p>
Yes, this seems to be resolved. Thank you, Barry.<br />
</p>
<p>
There is another perhaps associated issue.<br />
If an ImagePlus is asked to be hidden, it does not get hidden.<br />
</p>
<p>
For example, from a plugin I call the BinaryLabel plugin which creates a new image <br />
called "Labelled" and I try to hide it. In IJ2 it remains open.<br />
</p>
<p>
This works in IJ1:<br />
IJ.run(imp2,"BinaryLabel ", "white"); <br />
IJ.selectWindow("Labelled");<br />
imp5 =  IJ.getImage();<br />
ip5=imp5.getProcessor();<br />
imp5.hide();<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-12">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:12" class="cnum">
      <a href="#comment:12">comment:12</a>
    </span>
                  </span>
                  Changed 2012-08-14T09:46:43-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>reopened</em> to <em>closed</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Gabriel, that issue is indeed different. I'll open a new ticket and CC you. Closing this ticket.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-13">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:13" class="cnum">
      <a href="#comment:13">comment:13</a>
    </span>
                  </span>
                  Changed 2012-08-14T10:53:23-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocking</strong>
        <em>1331</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
          </div>
        </div>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="/chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="/about"><strong>Trac 0.12.2</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the ImageJ project at<br /><a href="http://developer.imagej.net/">http://developer.imagej.net/</a></p>
    </div>
  </body>
</html>
