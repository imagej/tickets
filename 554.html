<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  
  <!-- See: http://trac.edgewall.org/wiki/TracInterfaceCustomization -->


  <head>
    <title>
      #554 (File::New::Hyperstack results in duplicate images being created/displayed)
     â€“ ImageJ
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link rel="stylesheet" href="trac.css" type="text/css" /><link rel="stylesheet" href="ticket.css" type="text/css" /><link rel="stylesheet" href="tracvote.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>
  <body>
    <div id="main">
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="554.html">Ticket #554</a>
          <span class="status">(closed defect: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened 2011-06-01T14:57:39-05:00</p>
    <p>Last modified 2011-10-19T11:12:36-05:00</p>
  </div>
  <h2 class="summary searchable">File::New::Hyperstack results in duplicate images being created/displayed</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        bdezonia
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        curtis
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              major
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <strike>imagej2-b1-initial</strike>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              Legacy Compatibility
        </td>
        <th id="h_version">
          Version:
        </th>
        <td headers="h_version">
              
        </td>
    </tr><tr>
        <th id="h_severity">
          Severity:
        </th>
        <td headers="h_severity">
              serious
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby">
        </td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking">
        </td>
        <th>
        </th>
        <td>
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
Run File::New::Hyperstack. Choose c = 3, z = 1, t = 1. Choose Composite. Say OK. Two multichannel images are displayed. They have the same data displayed. One Dataset looks correct. The other one has funky luts and some of the drawn text is garbled.<br />
</p>

    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed 2011-06-13T11:58:22-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Owner</strong>
        changed from <em>bdezonia</em> to <em>curtis</em>
    </li><li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>assigned</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
I think we need to make a pure IJ2 version of File :: New :: Hyperstack. For now assigning to Curtis as he may have a similar ticket about fixing File :: New to be multidimensional. If I should do this instead please assign this back to me.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed 2011-06-13T12:02:34-05:00 by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
Note: other ticket is <a class="new ticket" href="593.html" title="task: File :: New Image enhancement needed (new)">#593</a><br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed 2011-06-13T12:03:51-05:00 by curtis
                </h3>
                
    <div class="comment searchable">
      
      <p>
The plan is for the IJ2 NewImage plugin to be able to create N-dimensional images. The "File::New::Hyperstack" command is redundant and can go away.<br />
</p>
<p>
However, we still need to fix the issue of redundant images. I noticed a few places where this happens now, and I believe it is a larger bug in the legacy layer. We will have to fix it for IJ1 code to continue functioning.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed 2011-06-13T12:12:21-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Owner</strong>
        changed from <em>curtis</em> to <em>bdezonia</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
I will take this issue to try and find the duplicate image issue in the legacy layer.<br />
</p>
<p>
I've left <a class="new ticket" href="593.html" title="task: File :: New Image enhancement needed (new)">#593</a> to encompass the other changes mentioned in this ticket. I've tagged it with a little additional info.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed 2011-06-13T14:29:09-05:00 by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
Some quick investigation shows that the IJ1 plugin is registering two images. These registrations happen via updateAndDraw() and show() (calling legacyImageChanged()). It turns out the plugin creates an ImagePlus and then makes a CompositeImage from that. The legacy hooks see them as different things and registers both of them. Not sure about the best way to address this. This needs further investigation to nail down the exact issue and whats needs to be changed.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed 2011-06-13T14:30:58-05:00 by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
Note the show() and updateAndDraw() calls are happening many many times. The creation of a HyperStack works via a macro and perhaps the macro is repeatedly calling these methods which in this case might be unnecessary but which we have to work with.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed 2011-06-13T16:12:53-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Owner</strong>
        changed from <em>bdezonia</em> to <em>curtis</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Bug addressed as of 907c0d6e7bd76e08b77aed317f53b15142aa1b62.<br />
</p>
<p>
Fix - avoid calling legacyImageChanged() during batch mode drawing.<br />
</p>
<p>
Curtis can you review my code? I want to make sure my fix is legitimate. Let me know if there are any issues.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed 2011-07-27T15:01:50-05:00 by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        changed from <em>biweekly-2011: Jul-18 to Jul-29</em> to <em>biweekly-2011: Aug-01 to Aug-12</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-9">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:9" class="cnum">
      <a href="#comment:9">comment:9</a>
    </span>
                  </span>
                  Changed 2011-08-01T12:10:32-05:00 by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        changed from <em>biweekly-2011: Aug-01 to Aug-12</em> to <em>imagej-2.0-alpha5</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Milestone biweekly-2011: Aug-01 to Aug-12 deleted<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-10">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:10" class="cnum">
      <a href="#comment:10">comment:10</a>
    </span>
                  </span>
                  Changed 2011-10-18T15:42:56-05:00 by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>assigned</em> to <em>closed</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
I do not know if this fix is "legitimate" or not, in that the check "FunctionsMethods.InsideBatchDrawing &gt; 0" seems very scary to me. But I do not know enough to judge at the moment. I am closing this ticket, since the problem is fixed. We can reopen or create new tickets for any other problems related to this change.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-11">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:11" class="cnum">
      <a href="#comment:11">comment:11</a>
    </span>
                  </span>
                  Changed 2011-10-19T11:11:47-05:00 by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
Fix undone in 889f659ad129af101686052ec4150648302ed54e. Removing old fix doesn't seem to cause any problems. This original bug is no longer apparent. I have left the original bug fix code in place in comments and also documented another approach to a fix if needed.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-12">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:12" class="cnum">
      <a href="#comment:12">comment:12</a>
    </span>
                  </span>
                  Changed 2011-10-19T11:12:36-05:00 by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
Fix actually undone in ed6a130dd55d12161fdc33ba703cacdc87eec8b5<br />
</p>

    </div>

              </div>
          </div>
        </div>
    </div>
    </div>
  </body>
</html>
