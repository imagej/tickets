<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  
  <!-- See: http://trac.edgewall.org/wiki/TracInterfaceCustomization -->


  <head>
    <title>
      #848 (Select All/Copy behaving badly)
     â€“ ImageJ
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link rel="stylesheet" href="trac.css" type="text/css" /><link rel="stylesheet" href="ticket.css" type="text/css" /><link rel="stylesheet" href="tracvote.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>
  <body>
    <div id="main">
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="/ticket/848">Ticket #848</a>
          <span class="status">(closed defect: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened 2011-10-26T13:41:39-05:00</p>
    <p>Last modified 2011-11-02T16:00:54-05:00</p>
  </div>
  <h2 class="summary searchable">Select All/Copy behaving badly</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        bdezonia
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        bdezonia
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              major
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="closed milestone" href="/milestone/imagej2-b1-initial">imagej2-b1-initial</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              Legacy Compatibility
        </td>
        <th id="h_version">
          Version:
        </th>
        <td headers="h_version">
              
        </td>
    </tr><tr>
        <th id="h_severity">
          Severity:
        </th>
        <td headers="h_severity">
              serious
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby">
        </td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking">
        </td>
        <th>
        </th>
        <td>
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
The Copy command is not working correctly. Load blobs. If you Edit Select All (IJ1 version) and and Edit Copy the selection the displayed pixels are replaced with a monochrome green image. If you originally Edit Select All (IJ2 version) and then Edit Copy the original image inverts (maybe a color table changed?).<br />
</p>

    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed 2011-10-26T13:41:56-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Owner</strong>
        changed from <em>curtis</em> to <em>bdezonia</em>
    </li><li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>assigned</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed 2011-10-26T14:10:39-05:00 by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
In the case of image inverting note that this looks like a legacy layer issue with inverted lut images. For instance, one can load blobs and show info and the image inverts.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed 2011-10-31T12:34:06-05:00 by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
Image/LUT inversion opened as separate ticket: <a class="closed ticket" href="/ticket/849" title="defect: LUT tracking issue (closed: fixed)">#849</a><br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed 2011-10-31T14:06:50-05:00 by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
One can confirm with the probe that the pixel values are correctly maintained. The green square is just an overlay that is drawn over the image entirely. The problem has to do with overlay harmonization.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed 2011-11-01T13:21:57-05:00 by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
It's not really a harmonization issue. It's an overlay that is correctly created by the OverlayHarmonizer. It's just getting drawn incorrectly. Not sure if this is a JHotDraw bug or some logic error in SwingOverlayView. (Outside chance its a display timing issue)<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed 2011-11-02T15:39:07-05:00 by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
It looks like it's a problem with keeping the alpha value in sync during harmonization back and forth across the legacy layer. Removing a single call of setAlpha() in OverlayHarmonizer makes the problem go away. More details to follow.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed 2011-11-02T15:58:21-05:00 by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
Simple fix: encode the overlay's alpha value in the Roi's color. Then on translation back take the Roi's color's alpha component and use it to set the overlay's alpha. This seems to keep a handle on things.<br />
</p>
<p>
It might be better to binarize IJ2 alpha values to 0/255 on translation to IJ1. Coming back would then be difficult. However if we started maintaining a Overlay&lt;-&gt;Roi mapping (like we do for Display&lt;-&gt;ImagePlus) then we could recover alpha values correctly.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed 2011-11-02T16:00:54-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>assigned</em> to <em>closed</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Fixed as mentioned in previous comment in 343a5beb8751894ebb3ea00d595993c313369449.<br />
</p>

    </div>

              </div>
          </div>
        </div>
    </div>
    </div>
  </body>
</html>
