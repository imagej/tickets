<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  
  <!-- See: http://trac.edgewall.org/wiki/TracInterfaceCustomization -->


  <head>
    <title>
      #740 (Stack to Images slow)
     â€“ ImageJ
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link rel="stylesheet" href="trac.css" type="text/css" /><link rel="stylesheet" href="ticket.css" type="text/css" /><link rel="stylesheet" href="tracvote.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>
  <body>
    <div id="main">
    <div id="notice" style="width: 58em; max-width: 100%; margin-left: auto; margin-right: auto; border: 1px solid black; margin-bottom: 2em">
      <table>
        <tr>
          <td style="font-size: 72px; color: firebrick; padding: 0 10px 0 10px">&#9888;</td>
          <td>
            <p style="margin: 0.4em">
            NOTICE! This is a static HTML version of a legacy ImageJ Trac ticket.
            </p>
            <p style="margin: 0.4em">
            The ImageJ project now
            <a href="https://imagej.net/Issues">uses GitHub Issues</a> for issue tracking.
            </p>
            <p style="margin: 0.4em">
            Please
            <a href="https://github.com/imagej/imagej/issues/new">file all new issues</a>
            there.
            </p>
          </td>
        </tr>
      </table>
    </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="740.html">Ticket #740</a>
          <span class="status">(closed defect: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened 2011-09-06T12:11:43-05:00</p>
    <p>Last modified 2012-05-16T14:47:36-05:00</p>
  </div>
  <h2 class="summary searchable">Stack to Images slow</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        bdezonia
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        bdezonia
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              major
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <strike>imagej2-b2-bugfixes</strike>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              Legacy Compatibility
        </td>
        <th id="h_version">
          Version:
        </th>
        <td headers="h_version">
              
        </td>
    </tr><tr>
        <th id="h_severity">
          Severity:
        </th>
        <td headers="h_severity">
              serious
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby">
        </td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking">
              <a class="closed" href="1011.html" title="Robust ImageJ1 legacy layer">#1011</a>
        </td>
        <th>
        </th>
        <td>
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
The stack to images IJ1 command can run slowly. Determine if its too slow and needs to be fixed. If fixes needed track through the legacy layer and make improvements where possible.<br />
</p>

    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed 2011-09-21T15:00:46-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        changed from <em>imagej-2.0-beta1</em> to <em>imagej-2.0-beta2</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed 2012-02-26T20:55:10-06:00 by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocking</strong>
        <em>1011</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed 2012-05-08T10:49:04-05:00 by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
Seems a lot faster nowadays (tested with a five slice stack on Linux)<br />
</p>
<p>
However, using new HyperStack create a 1 ch, 1 frame, 15 slice stack. Run Stack To Images and nothing happens. Run it again and you get an exception<br />
</p>
<p>
java.lang.NullPointerException<br />
</p>
<blockquote>
<p>
at ij.gui.ImageWindow.close(ImageWindow.java:343)<br />
at ij.gui.StackWindow.close(StackWindow.java:169)<br />
at ij.plugin.StackEditor.convertStackToImages(StackEditor.java:268)<br />
at ij.plugin.StackEditor.run(StackEditor.java:27)<br />
at ij.IJ.runPlugIn(IJ.java:156)<br />
at ij.IJ.runPlugIn(IJ.java:139)<br />
at imagej.legacy.plugin.LegacyPlugin.run(LegacyPlugin.java:146)<br />
at imagej.ext.plugin.PluginModule.run(PluginModule.java:151)<br />
at imagej.ext.module.ModuleRunner.run(ModuleRunner.java:150)<br />
at imagej.ext.module.ModuleRunner.call(ModuleRunner.java:120)<br />
at imagej.ext.module.ModuleRunner.call(ModuleRunner.java:1)<br />
at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)<br />
at java.util.concurrent.FutureTask.run(FutureTask.java:166)<br />
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)<br />
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)<br />
at java.lang.Thread.run(Thread.java:679)<br />
</p>
</blockquote>

    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed 2012-05-08T12:31:31-05:00 by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
Also fails on Mac. It looks like LegacyPlugin::run() is stuck in waitForPluginThreads()<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed 2012-05-08T13:05:18-05:00 by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
With a62a04f3d598487b08b1f1c0f1e794a1a54a6b5b waitForPlugThreads() should no longer hang.<br />
</p>
<p>
Note that this command now completes but takes a LONG time with no updates to UI. One could think the command did not run. IJ1 does not update the status area when it runs so we have nothing to display.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed 2012-05-08T13:58:07-05:00 by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
With 83e1cad8c114c9b3d1276710ecf7e83a406800a7 update users via status events that IJ2 is running an IJ1 plugin. This lets the user know their command was launched and is helpful info when a legacy plugin takes a while to complete.<br />
</p>
<p>
TODO - determine why Stack To Images with 15 slices is so much slower than IJ1<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed 2012-05-09T12:40:54-05:00 by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
After a little investigation it appears the pauses are due to two things<br />
</p>
<ul><li>it looks like JHotDraw is trying to load images across the network when a display is created
</li><li>SwingUI::onDisplayCreated() is eating the lion's share of the time calling createMenuBars
</li></ul><p>
Addressing part two is hatched as part of ticket <a class="closed ticket" href="1160.html" title="defect: Menu bar creation is slow (closed: fixed)">#1160</a><br />
</p>
<p>
The remaining work on this ticket is to determine what JHotDraw is doing.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed 2012-05-14T10:13:39-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        changed from <em>imagej-2.0.0-beta3</em> to <em>imagej-2.0.0-beta2</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-9">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:9" class="cnum">
      <a href="#comment:9">comment:9</a>
    </span>
                  </span>
                  Changed 2012-05-16T14:47:36-05:00 by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>closed</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Debugging into JHotDraw it seems that nothing is taking extra time. Image Fetcher threads do get hatched and don't go away but I think those are left over from the IJ1 plugin. When I interrupt the program while the slow refresh state is happening I am inside menu creation code and related state setting code. Breakpointing everything that could create an Image Fetcher shows they aren't hatched by JHotDraw. I think this bug is all menu creation time and thus I am closing this ticket.<br />
</p>

    </div>

              </div>
          </div>
        </div>
    </div>
    </div>
  </body>
</html>
