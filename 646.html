<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  
  <!-- See: http://trac.edgewall.org/wiki/TracInterfaceCustomization -->


  <head>
    <title>
      #646 (IJ2 App bar does not accept events)
     â€“ ImageJ
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link rel="search" href="/search" />
        <link rel="prev" href="/ticket/645" title="Ticket #645" />
        <link rel="last" href="/ticket/2043" title="Ticket #2043" />
        <link rel="help" href="/wiki/TracGuide" />
        <link rel="alternate" href="/ticket/646?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="/ticket/646?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="/ticket/646?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="/ticket/647" title="Ticket #647" />
        <link rel="start" href="/wiki" />
        <link rel="stylesheet" href="/chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="/chrome/common/css/ticket.css" type="text/css" /><link rel="stylesheet" href="/chrome/vote/css/tracvote.css" type="text/css" />
        <link rel="first" href="/ticket/1" title="Ticket #1" />
        <link rel="shortcut icon" href="/chrome/site/imagej-16.png" type="image/png" />
        <link rel="icon" href="/chrome/site/imagej-16.png" type="image/png" />
      <link type="application/opensearchdescription+xml" rel="search" href="/search/opensearch" title="Search ImageJ" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="6d61568275a315de78e2a627";
    </script>
    <script type="text/javascript" src="/chrome/common/js/jquery.js"></script><script type="text/javascript" src="/chrome/common/js/babel.js"></script><script type="text/javascript" src="/chrome/common/js/trac.js"></script><script type="text/javascript" src="/chrome/common/js/search.js"></script><script type="text/javascript" src="/chrome/common/js/folding.js"></script><script type="text/javascript" src="/chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="/chrome/common/js/resizer.js"></script><script type="text/javascript" src="/chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 646, escape_newlines: 1}
        $("#comment").autoPreview("/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="/chrome/site/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://developer.imagej.net/"><img src="http://developer.imagej.net/files/imagej/logo.png" alt="ImageJ Trac" /></a>
      </div>
      <form id="search" action="/search" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="/login">Login</a></li><li><a href="/prefs">Preferences</a></li><li><a href="/wiki/TracGuide">Help/Guide</a></li><li><a href="/about">About Trac</a></li><li class="last"><a href="/reset_password">Forgot your password?</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="/wiki">Wiki</a></li><li><a href="/timeline">Timeline</a></li><li><a href="/roadmap">Roadmap</a></li><li class="active"><a href="/report">View Tickets</a></li><li class="last"><a href="/search">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span id="vote" title="Vote count"><img src="/chrome/vote/aupgray.png" alt="Up-vote" /><span id="votes">+0</span><img src="/chrome/vote/adowngray.png" alt="Down-vote" /></span></li><li><span>&larr; <a class="prev" href="/ticket/645" title="Ticket #645">Previous Ticket</a></span></li><li class="last"><span><a class="next" href="/ticket/647" title="Ticket #647">Next Ticket</a> &rarr;</span></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="/ticket/646">Ticket #646</a>
          <span class="status">(closed defect: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="/timeline?from=2011-06-28T13%3A27%3A03-05%3A00&amp;precision=second" title="2011-06-28T13:27:03-05:00 in Timeline">8 years</a> ago</p>
    <p>Last modified <a class="timeline" href="/timeline?from=2011-11-07T15%3A02%3A02-06%3A00&amp;precision=second" title="2011-11-07T15:02:02-06:00 in Timeline">8 years</a> ago</p>
  </div>
  <h2 class="summary searchable">IJ2 App bar does not accept events</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="/query?status=!closed&amp;reporter=bdezonia">bdezonia</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="/query?status=!closed&amp;owner=curtis">curtis</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="/query?status=!closed&amp;priority=major">major</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="closed milestone" href="/milestone/imagej2-b1-initial">imagej2-b1-initial</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="/query?status=!closed&amp;component=Core">Core</a>
        </td>
        <th id="h_version">
          Version:
        </th>
        <td headers="h_version">
              <a href="/query?status=!closed&amp;version"></a>
        </td>
    </tr><tr>
        <th id="h_severity">
          Severity:
        </th>
        <td headers="h_severity">
              <a href="/query?status=!closed&amp;severity=serious">serious</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby">
        </td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking">
        </td>
        <th>
        </th>
        <td>
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
Not sure if this is a problem or not.<br />
</p>
<p>
In IJ1 the app bar routed events to listeners. IJ2 does not follow this design. Rather, each display has an EventDispatcher attached to it.<br />
</p>
<p>
This causes a (probably minor) issue in that no events are generated when you do not have an active display.<br />
</p>
<p>
Example:<br />
</p>
<blockquote>
<p>
open a 2d image<br />
select the app window<br />
</p>
</blockquote>
<dl class="wiki"><dt>fire the menu entry Process</dt><dd>Shadows :: Shadows Demo
press ESC - demo does not terminate
select display window
press ESC - demo terminates
</dd></dl>
<p>
Possible fixes:<br />
</p>
<ul><li>make active display always tied to some display if any are open
</li></ul><blockquote>
<blockquote>
<p>
Do not allow app bar to take focus<br />
</p>
</blockquote>
</blockquote>
<ul><li>make app bar have an event displatcher attached to it so it can
</li></ul><blockquote>
<blockquote>
<p>
forward events<br />
</p>
</blockquote>
</blockquote>
<ul><li>ignore this issue
</li></ul><p>
Requesting feedback before doing anything on this ticket.<br />
</p>

    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2011-06-28T13%3A43%3A30-05%3A00&amp;precision=second" title="2011-06-28T13:43:30-05:00 in Timeline">8 years</a> ago by curtis
                </h3>
                
    <div class="comment searchable">
      
      <p>
Before we go too far down this road, we should discuss some specifics of interactive plugins, and specifically plugins that listen to user input.<br />
</p>
<p>
The design of the ImageJ2 user input events is strongly tied to displays because it was intended to interact with tools, which bind user input to actions in a display. Conversely, the IJ2 plugin design was NOT originally intended to allow interactive input. However, in the case of something like the Shadows demo that runs until the user manually terminates it, we will need to make a decision on how things should work.<br />
</p>
<p>
Personally, I do not like that an interactive plugin must manually subscribe itself to IJ2 input events if it wants to listen to them. Perhaps there should be another, simpler mechanism for this. Keep in mind that the IJ2 plugin infrastructure is intended to be plugged into various non-ImageJ software (CellProfiler, KNIME, OMERO, Icy, etc.) and the more bells and whistles it has, the harder it is for these other programs to fully support it. We may want to create a new interface called InteractivePlugin that these interactive plugins implement, which other software can opt not to support. This interface can provide callback methods similar to the ITool interface. Perhaps InteractivePlugin and ITool can even extend the same InputListener interface? The downside is that interactive plugins must then implement ~8 callback methods even if only one of them is needed. We could get around that by having an InputAdapter abstract class similar to e.g. WindowAdapter.<br />
</p>
<p>
In this way, the Shadows demo could avoid needing to manually subscribe to input events. However, we still need a solution to the app bar issue. It would be simple enough to add an EventDispatcher to the app bar that passes null for the display. We may want to examine other IJ1 interactive plugins before we make a final design decision about it, though.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2011-07-27T14%3A46%3A24-05%3A00&amp;precision=second" title="2011-07-27T14:46:24-05:00 in Timeline">8 years</a> ago by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        changed from <em>biweekly-2011: Jul-18 to Jul-29</em> to <em>imagej-2.0-beta1</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2011-11-01T10%3A56%3A50-05%3A00&amp;precision=second" title="2011-11-01T10:56:50-05:00 in Timeline">8 years</a> ago by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>accepted</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2011-11-06T22%3A14%3A53-06%3A00&amp;precision=second" title="2011-11-06T22:14:53-06:00 in Timeline">8 years</a> ago by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>accepted</em> to <em>closed</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
As of 21c44aa89c7ce812c49ef41fc2c186b777e31e1d, the app frame publishes key events with a null display. Anything interested can respond to those accordingly. For example, for Shadows Demo to handle Esc from the app frame properly, it would need to do more than just check:<br />
</p>
<pre class="wiki">event.getDisplay() == currDisplay
</pre><p>
but also check something like:<br />
</p>
<pre class="wiki">event.getDisplay() == null &amp;&amp;
  imageDisplayService.getActiveImageDisplay() == currDisplay
</pre><p>
That said, the original issue described by this ticket is resolved.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2011-11-07T15%3A02%3A02-06%3A00&amp;precision=second" title="2011-11-07T15:02:02-06:00 in Timeline">8 years</a> ago by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
In 5bc3c3626c11fa96aa8e56d4a19d25bf56c8411d put in above logic for terminating a shadows demo when the app generates the ESC key event<br />
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="/wiki/TracTickets">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="/ticket/646?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="/ticket/646?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="/ticket/646?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="/chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="/about"><strong>Trac 0.12.2</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the ImageJ project at<br /><a href="http://developer.imagej.net/">http://developer.imagej.net/</a></p>
    </div>
  </body>
</html>