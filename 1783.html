<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  
  <!-- See: http://trac.edgewall.org/wiki/TracInterfaceCustomization -->


  <head>
    <title>
      #1783 (Make version binding tighter for reproducible builds)
     â€“ ImageJ
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link rel="search" href="/search" />
        <link rel="prev" href="/ticket/1782" title="Ticket #1782" />
        <link rel="last" href="/ticket/2043" title="Ticket #2043" />
        <link rel="help" href="/wiki/TracGuide" />
        <link rel="alternate" href="/ticket/1783?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="/ticket/1783?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="/ticket/1783?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="/ticket/1784" title="Ticket #1784" />
        <link rel="start" href="/wiki" />
        <link rel="stylesheet" href="/chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="/chrome/common/css/ticket.css" type="text/css" /><link rel="stylesheet" href="/chrome/vote/css/tracvote.css" type="text/css" />
        <link rel="first" href="/ticket/1" title="Ticket #1" />
        <link rel="shortcut icon" href="/chrome/site/imagej-16.png" type="image/png" />
        <link rel="icon" href="/chrome/site/imagej-16.png" type="image/png" />
      <link type="application/opensearchdescription+xml" rel="search" href="/search/opensearch" title="Search ImageJ" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="0b5dbc4827dda890a1bceadc";
    </script>
    <script type="text/javascript" src="/chrome/common/js/jquery.js"></script><script type="text/javascript" src="/chrome/common/js/babel.js"></script><script type="text/javascript" src="/chrome/common/js/trac.js"></script><script type="text/javascript" src="/chrome/common/js/search.js"></script><script type="text/javascript" src="/chrome/common/js/folding.js"></script><script type="text/javascript" src="/chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="/chrome/common/js/resizer.js"></script><script type="text/javascript" src="/chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 1783, escape_newlines: 1}
        $("#comment").autoPreview("/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="/chrome/site/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://developer.imagej.net/"><img src="http://developer.imagej.net/files/imagej/logo.png" alt="ImageJ Trac" /></a>
      </div>
      <form id="search" action="/search" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="/login">Login</a></li><li><a href="/prefs">Preferences</a></li><li><a href="/wiki/TracGuide">Help/Guide</a></li><li><a href="/about">About Trac</a></li><li class="last"><a href="/reset_password">Forgot your password?</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="/wiki">Wiki</a></li><li><a href="/timeline">Timeline</a></li><li><a href="/roadmap">Roadmap</a></li><li class="active"><a href="/report">View Tickets</a></li><li class="last"><a href="/search">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span id="vote" title="Vote count"><img src="/chrome/vote/aupgray.png" alt="Up-vote" /><span id="votes">+0</span><img src="/chrome/vote/adowngray.png" alt="Down-vote" /></span></li><li><span>&larr; <a class="prev" href="/ticket/1782" title="Ticket #1782">Previous Ticket</a></span></li><li><span><a class="next" href="/ticket/1784" title="Ticket #1784">Next Ticket</a> &rarr;</span></li><li class="last"><a href="/depgraph/1783">Depgraph</a></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="/ticket/1783">Ticket #1783</a>
          <span class="status">(closed feature: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="/timeline?from=2013-04-08T12%3A40%3A57-05%3A00&amp;precision=second" title="2013-04-08T12:40:57-05:00 in Timeline">6 years</a> ago</p>
    <p>Last modified <a class="timeline" href="/timeline?from=2014-05-01T16%3A19%3A56-05%3A00&amp;precision=second" title="2014-05-01T16:19:56-05:00 in Timeline">5 years</a> ago</p>
  </div>
  <h2 class="summary searchable">Make version binding tighter for reproducible builds</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="/query?status=!closed&amp;reporter=dscho">dscho</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="/query?status=!closed&amp;owner=dscho">dscho</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="/query?status=!closed&amp;priority=major">major</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="milestone" href="/milestone/imagej-2.5.0">imagej-2.5.0</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="/query?status=!closed&amp;component=Build+System">Build System</a>
        </td>
        <th id="h_version">
          Version:
        </th>
        <td headers="h_version">
              <a href="/query?status=!closed&amp;version="></a>
        </td>
    </tr><tr>
        <th id="h_severity">
          Severity:
        </th>
        <td headers="h_severity">
              <a href="/query?status=!closed&amp;severity=major">major</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
              <a href="/query?status=!closed&amp;cc=~curtis">curtis</a>
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby">
              <a class="closed" href="/ticket/1784" title="Add a Jenkins job that can release a new pom-scijava and update our Maven ...">#1784</a>, <a class="closed" href="/ticket/1785" title="Investigate better ways to use the maven-release-plugin">#1785</a>, <a class="closed" href="/ticket/1786" title="Add a Jenkins job warning about API changes without version bumps">#1786</a>, <a class="closed" href="/ticket/1787" title="Enhance the ''ImageJ-style'' Jenkins job">#1787</a>, <a class="closed" href="/ticket/1788" title="Write up a public rationale for how and why we changed versioning to ...">#1788</a>
        </td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking">
        </td>
        <th>
        </th>
        <td>
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
ImageJ2 is not a stand-alone project; it depends on ImgLib2, scijava-common, pom-scijava and SCIFIO. Fiji depends on all of them.<br />
</p>
<p>
Builds, however, are not reproducible (as can be seen by failing <tt></tt>git bisect<tt></tt> and Jenkins' Fiji build failures). The reason is that there are -SNAPSHOT version couplings.<br />
</p>
<p>
Goal: get rid of all -SNAPSHOT dependencies in all of above-mentioned projects.<br />
</p>
<p>
To maintain ease of development, this implies introducing some tools:<br />
</p>
<ul><li>just like <a class="ext-link" href="http://jenkins.imagej.net/job/Synchronize-and-deploy-IJ1/"><span class="icon">Â </span>http://jenkins.imagej.net/job/Synchronize-and-deploy-IJ1/</a> synchronizes ImageJ 1.x fully automatically, commits, pushes and deploys, we need Jenkins jobs (most likely manually triggered, however) to help bumping up the version in one of our projects.
</li><li>the Jenkins job should also trigger dependent projects to update, e.g. a scijava-common bump should bump pom-scijava which in turn should bump the rest of 'em.
</li><li>this Jenkins job should avoid pushing updated 'master' branches when builds fail, but simply mark the builds as failed.
</li><li>we need a Jenkins job to warn about API changes in -SNAPSHOT versions. Most likely, this job should make use of the Animal Sniffer Maven plugin: <a class="ext-link" href="http://mojo.codehaus.org/animal-sniffer-maven-plugin/"><span class="icon">Â </span>http://mojo.codehaus.org/animal-sniffer-maven-plugin/</a>.
</li><li>the Animal Sniffer job could automatically push branches as appropriate for micro, minor and major version increases to a special namespace (e.g. refs/suggested/) to ease the maintenance burden.
</li><li>it would probably be a good idea to extend <a class="ext-link" href="http://jenkins.imagej.net/job/ImageJ-style/"><span class="icon">Â </span>http://jenkins.imagej.net/job/ImageJ-style/</a> to check also for SNAPSHOT dependencies pushed to <em>master</em> by mistake.
</li><li><a class="ext-link" href="http://jenkins.imagej.net/job/ImageJ-style/"><span class="icon">Â </span>http://jenkins.imagej.net/job/ImageJ-style/</a> could be extended to fix easy-to-fix problems and commit &amp; push them to <em>master</em>.
</li></ul><p>
The idea is really to help the development process without adding a substantial burden on the developers. Tools should be helpful, not create more work.<br />
</p>

    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-04-08T12%3A42%3A12-05%3A00&amp;precision=second" title="2013-04-08T12:42:12-05:00 in Timeline">6 years</a> ago by dscho
                </h3>
                
    <div class="comment searchable">
      
      <p>
Ah, and of course: the Jenkins jobs should be written as <em>.sh</em> scripts in scijava-common's <em>bin/</em> directory for transparency.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-04-08T12%3A58%3A52-05%3A00&amp;precision=second" title="2013-04-08T12:58:52-05:00 in Timeline">6 years</a> ago by curtis
                </h3>
                
    <div class="comment searchable">
      
      <p>
We will also write up a public rationale for how and why we do versioning this way for SciJava projects (SciJava Common, SCIFIO, ImgLib, ImageJ, Fiji, <a class="ext-link" href="https://github/uw-loci"><span class="icon">Â </span>LOCI projects</a>, etc.):<br />
</p>
<ul><li>Conformity to <a class="ext-link" href="http://semver.org/"><span class="icon">Â </span>SemVer</a> versioning system.
</li><li>Fixed release version couplings (i.e., no SNAPSHOTs, no version ranges) for build reproducibility, and hence bisectability, along with many other benefits.
</li><li>There is nothing wrong with SNAPSHOT or version range couplings, as long as you understand the tradeoffs. Any downstream projects can continue to use these with SciJava projects, as long as they understand that their builds will not be reproducible.
</li><li>It is not our intent to enforce any particular workflow on people developing on master. If people want to break API left and right during development on master, that is their prerogative. However, it does incur a slight (temporary) technical debt when making the next release, since either: A) any breaking changes would need to be "undone" (i.e., readding any previous method signatures with deprecation tags); or B) the next release would need a major version bump indicating lack of backwards compatibility. Obviously (A) is preferred, and the Animal Sniffer Maven plugin and related tooling (discussed above) will be very helpful in assisting in pursuit of (A).
</li><li>Of course, it is strongly preferred that for each commit to master (including all commits as part of a merge commit), code still compile, hence the CI jobs for testing this. For a variety of reasons, broken builds on master should be fixed as soon as possible.
</li><li>The only new requirement process-wise is that code on master should not introduce any SNAPSHOT dependencies, because those commits will then not have a reproducible build. Any SNAPSHOT dependencies on master should be reverted to fixed release dependencies as soon as possible, just like failing builds. We may create a Jenkins job to check this, which fails in the case of invalid dependency versions. (To put another way: we want it to be possible to cut a release from master as easily as possible. This means code with only fixed release dependencies, which compiles and has passing unit tests.)
</li></ul><p>
Lastly, the <a class="ext-link" href="http://mojo.codehaus.org/versions-maven-plugin/"><span class="icon">Â </span>versions-maven-plugin</a> is a great tool for verifying that you are using the latest release version of both Maven plugins and project dependencies. We can make use of it when performing prerelease checks.<br />
</p>

    </div>

                <div class="trac-lastedit ">
                  Last edited <a class="timeline" href="/timeline?from=2013-04-08T12%3A59%3A22-05%3A00&amp;precision=second" title="2013-04-08T12:59:22-05:00 in Timeline">6 years</a> ago
                      by curtis
                    (<a href="/ticket/1783?cversion=0&amp;cnum_hist=2#comment:2">previous</a>)
                    (<a href="/ticket/1783?action=comment-diff&amp;cnum=2&amp;version=1">diff</a>)
                </div>
              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-04-08T13%3A16%3A23-05%3A00&amp;precision=second" title="2013-04-08T13:16:23-05:00 in Timeline">6 years</a> ago by curtis
                </h3>
                
    <div class="comment searchable">
      
      <p>
One other thing that dscho &amp; I discussed: we ideally want to use the <a class="ext-link" href="http://maven.apache.org/maven-release/maven-release-plugin/"><span class="icon">Â </span>Maven Release plugin</a> to perform our releases. However, the default behavior of <tt>mvn release:prepare</tt> cuts the release on master and then pushes it. We would prefer to cut the release to the (orphaned) tag itself, and only commit the SNAPSHOT version bump on master. I.e., no commit on master should have a release version in the POM. This is how we've been doing it with our <a class="ext-link" href="https://github.com/imagej/imagej/blob/v2.0.0-beta6/bin/tag-release.sh"><span class="icon">Â </span>tag-release.sh</a> script. The <tt>mvn release:branch</tt> goal might be a solution there; further investigation should be a subticket of this feature.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-04-08T13%3A52%3A53-05%3A00&amp;precision=second" title="2013-04-08T13:52:53-05:00 in Timeline">6 years</a> ago by dscho
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>1784</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-04-08T14%3A01%3A57-05%3A00&amp;precision=second" title="2013-04-08T14:01:57-05:00 in Timeline">6 years</a> ago by dscho
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>1785</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-04-08T14%3A11%3A12-05%3A00&amp;precision=second" title="2013-04-08T14:11:12-05:00 in Timeline">6 years</a> ago by dscho
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>1786</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-04-08T14%3A13%3A04-05%3A00&amp;precision=second" title="2013-04-08T14:13:04-05:00 in Timeline">6 years</a> ago by dscho
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>1787</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-04-08T14%3A18%3A44-05%3A00&amp;precision=second" title="2013-04-08T14:18:44-05:00 in Timeline">6 years</a> ago by dscho
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>1788</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-9">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:9" class="cnum">
      <a href="#comment:9">comment:9</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2014-05-01T16%3A19%3A56-05%3A00&amp;precision=second" title="2014-05-01T16:19:56-05:00 in Timeline">5 years</a> ago by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>closed</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
We did it! SciJava, SCIFIO, ImgLib2 and ImageJ now use only release couplings between components.<br />
</p>
<p>
There is still some work to be done splitting ImgLib2 to separate repositories, as well as getting Fiji fully transitioned away from snapshot couplings, but that will come with time. No need to keep this ticket around reminding us.<br />
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="/wiki/TracTickets">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="/ticket/1783?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="/ticket/1783?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="/ticket/1783?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="/chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="/about"><strong>Trac 0.12.2</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the ImageJ project at<br /><a href="http://developer.imagej.net/">http://developer.imagej.net/</a></p>
    </div>
  </body>
</html>