<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  
  <!-- See: http://trac.edgewall.org/wiki/TracInterfaceCustomization -->


  <head>
    <title>
      #13 (Improve undo/redo functionality)
     â€“ ImageJ
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link rel="search" href="/search" />
        <link rel="prev" href="/ticket/12" title="Ticket #12" />
        <link rel="last" href="/ticket/2043" title="Ticket #2043" />
        <link rel="help" href="/wiki/TracGuide" />
        <link rel="alternate" href="/ticket/13?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="/ticket/13?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="/ticket/13?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="/ticket/14" title="Ticket #14" />
        <link rel="start" href="/wiki" />
        <link rel="stylesheet" href="/chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="/chrome/common/css/ticket.css" type="text/css" /><link rel="stylesheet" href="/chrome/vote/css/tracvote.css" type="text/css" />
        <link rel="first" href="/ticket/1" title="Ticket #1" />
        <link rel="shortcut icon" href="/chrome/site/imagej-16.png" type="image/png" />
        <link rel="icon" href="/chrome/site/imagej-16.png" type="image/png" />
      <link type="application/opensearchdescription+xml" rel="search" href="/search/opensearch" title="Search ImageJ" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="846044186fc6d23d817ccf85";
    </script>
    <script type="text/javascript" src="/chrome/common/js/jquery.js"></script><script type="text/javascript" src="/chrome/common/js/babel.js"></script><script type="text/javascript" src="/chrome/common/js/trac.js"></script><script type="text/javascript" src="/chrome/common/js/search.js"></script><script type="text/javascript" src="/chrome/common/js/folding.js"></script><script type="text/javascript" src="/chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="/chrome/common/js/resizer.js"></script><script type="text/javascript" src="/chrome/common/js/auto_preview.js"></script><script type="text/javascript" src="/chrome/mastertickets/disable_resolve.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 13, escape_newlines: 1}
        $("#comment").autoPreview("/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="/chrome/site/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://developer.imagej.net/"><img src="http://developer.imagej.net/files/imagej/logo.png" alt="ImageJ Trac" /></a>
      </div>
      <form id="search" action="/search" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="/login">Login</a></li><li><a href="/prefs">Preferences</a></li><li><a href="/wiki/TracGuide">Help/Guide</a></li><li><a href="/about">About Trac</a></li><li class="last"><a href="/reset_password">Forgot your password?</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="/wiki">Wiki</a></li><li><a href="/timeline">Timeline</a></li><li><a href="/roadmap">Roadmap</a></li><li class="active"><a href="/report">View Tickets</a></li><li class="last"><a href="/search">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span id="vote" title="Vote count"><img src="/chrome/vote/aupgray.png" alt="Up-vote" /><span id="votes">+0</span><img src="/chrome/vote/adowngray.png" alt="Down-vote" /></span></li><li><span>&larr; <a class="prev" href="/ticket/12" title="Ticket #12">Previous Ticket</a></span></li><li><span><a class="next" href="/ticket/14" title="Ticket #14">Next Ticket</a> &rarr;</span></li><li class="last"><a href="/depgraph/13">Depgraph</a></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="/ticket/13">Ticket #13</a>
          <span class="status">(closed feature: moved)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="/timeline?from=2010-02-16T16%3A43%3A21-06%3A00&amp;precision=second" title="2010-02-16T16:43:21-06:00 in Timeline">9 years</a> ago</p>
    <p>Last modified <a class="timeline" href="/timeline?from=2013-04-15T09%3A55%3A25-05%3A00&amp;precision=second" title="2013-04-15T09:55:25-05:00 in Timeline">6 years</a> ago</p>
  </div>
  <h2 class="summary searchable">Improve undo/redo functionality</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="/query?status=!closed&amp;reporter=curtis">curtis</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="/query?status=!closed&amp;owner=curtis">curtis</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="/query?status=!closed&amp;priority=major">major</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="milestone" href="/milestone/imagej2-b10-compatibility">imagej2-b10-compatibility</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="/query?status=!closed&amp;component=Scripting">Scripting</a>
        </td>
        <th id="h_version">
          Version:
        </th>
        <td headers="h_version">
              <a href="/query?status=!closed&amp;version"></a>
        </td>
    </tr><tr>
        <th id="h_severity">
          Severity:
        </th>
        <td headers="h_severity">
              <a href="/query?status=!closed&amp;severity=non-issue">non-issue</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby">
              <a class="new" href="/ticket/1463" title="Legacy Undo needs to be overridden">#1463</a>
        </td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking">
              <a class="new" href="/ticket/1543" title="Make noise reduction commands work right with undo/redo">#1543</a>
        </td>
        <th>
        </th>
        <td>
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
A difficult problem common to many applications is that of the undo history. Ideally, we would like ImageJ to support multiple undo and redo as efficiently as possible. There are two major kinds of undoable operations:<br />
</p>
<ol><li>Some operations such as adding a ROI are simple to invert efficiently (just delete it). We can use a <a class="closed ticket" href="/ticket/12" title="feature: Redesign scripting infrastructure (closed: fixed)">command recorder system</a> to keep track of such workflows both backwards and forwards to allow undo and redo.
</li><li>Other operations such as dithering are more destructive, and ImageJ must somehow cache the prior state of the image in order to successfully undo the change.
</li></ol><p>
As such, support for a hybrid undo history supporting both types of operations may be the way to go.<br />
</p>

    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2010-02-16T16%3A44%3A32-06%3A00&amp;precision=second" title="2010-02-16T16:44:32-06:00 in Timeline">9 years</a> ago by curtis
                </h3>
                
    <div class="comment searchable">
      
      <p>
This ticket is related to both <a class="closed ticket" href="/ticket/12" title="feature: Redesign scripting infrastructure (closed: fixed)">scripting infrastructure</a> and <a class="closed ticket" href="/ticket/14" title="feature: Better event notifications (closed: fixed)">event notification</a>.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2010-03-01T17%3A07%3A24-06%3A00&amp;precision=second" title="2010-03-01T17:07:24-06:00 in Timeline">9 years</a> ago by gharris
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>accepted</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2011-03-13T21%3A21%3A09-05%3A00&amp;precision=second" title="2011-03-13T21:21:09-05:00 in Timeline">8 years</a> ago by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        changed from <em>imagej-2.0-alpha1</em> to <em>imagej-2.0-beta1</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2011-06-06T11%3A18%3A35-05%3A00&amp;precision=second" title="2011-06-06T11:18:35-05:00 in Timeline">8 years</a> ago by gharris
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        changed from <em>imagej-2.0-beta1</em> to <em>imagej-2.0-beta2</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2012-01-26T12%3A44%3A45-06%3A00&amp;precision=second" title="2012-01-26T12:44:45-06:00 in Timeline">7 years</a> ago by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Owner</strong>
        changed from <em>gharris</em> to <em>curtis</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2012-02-23T11%3A10%3A24-06%3A00&amp;precision=second" title="2012-02-23T11:10:24-06:00 in Timeline">7 years</a> ago by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Type</strong>
        changed from <em>task</em> to <em>story</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2012-02-23T11%3A18%3A53-06%3A00&amp;precision=second" title="2012-02-23T11:18:53-06:00 in Timeline">7 years</a> ago by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocking</strong>
        <em>6</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2012-03-05T14%3A33%3A36-06%3A00&amp;precision=second" title="2012-03-05T14:33:36-06:00 in Timeline">7 years</a> ago by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocking</strong>
        <em>6</em> removed
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-9">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:9" class="cnum">
      <a href="#comment:9">comment:9</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2012-07-03T12%3A38%3A49-05%3A00&amp;precision=second" title="2012-07-03T12:38:49-05:00 in Timeline">7 years</a> ago by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        changed from <em>imagej-2.0.0-beta3</em> to <em>imagej-2.0.0-beta4</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-10">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:10" class="cnum">
      <a href="#comment:10">comment:10</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2012-08-03T13%3A38%3A16-05%3A00&amp;precision=second" title="2012-08-03T13:38:16-05:00 in Timeline">7 years</a> ago by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        changed from <em>imagej-2.0.0-beta4</em> to <em>imagej-2.0.0-beta5</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Pushing to beta5.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-11">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:11" class="cnum">
      <a href="#comment:11">comment:11</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2012-09-07T12%3A48%3A19-05%3A00&amp;precision=second" title="2012-09-07T12:48:19-05:00 in Timeline">7 years</a> ago by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocked By</strong>
        <em>1463</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-12">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:12" class="cnum">
      <a href="#comment:12">comment:12</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2012-09-20T11%3A30%3A35-05%3A00&amp;precision=second" title="2012-09-20T11:30:35-05:00 in Timeline">7 years</a> ago by bdezonia
                </h3>
                
    <div class="comment searchable">
      
      <p>
After a little discussion with Curtis:<br />
</p>
<p>
There are three kinds of things that need to be stored in the undo history: the entire state of an object, the change by the last plugin Command, and the change by the last tool operation. This should allow us to capture all changes (right?) and helps minimize the size of the undo history when feasible.<br />
</p>
<p>
For the snapshot of an entire set of data we need to serialize it, and during an undo operation restore it in a timely fashion. (Note: a Snapshot is just a Command that is itself reversible and would be stored in the undo history like any other command).<br />
</p>
<p>
For commands that are invertible we need to be able to record the Command and it's mirror partner Command (Rotate 90 Left and Rotate 90 Right). In some case rounding issues might be a problem and then we just do a snapshot instead.<br />
</p>
<p>
For the tools there are gestures that are important. We might just record a gesture at each mouse up. We might combine gestures so that it is less granular than that. Note that tools would need to be enhanced to generate events that the undo engine can track.<br />
</p>
<p>
An example of why gestures are needed: in IJ2 hotdraw figures are first created with default values and then edited later by user gestures. We can't just capture a roi on creation and persist that info in the undo history. We also need the edits. But we want to group them so that an undo of a drawn roi would not be tedious and its not clear when the editing mode is "done". (Note the undo history might need to be smart about autocombining gestures)<br />
</p>
<p>
The undo facility can be event driven (like a macro command recording history would). There is a whole set of events that get generated when modules are created, preprocessed, run, completed, etc. The undo facility should tap into this so that things are automatically recorded when possible.<br />
</p>
<p>
Perhaps Commands could implement a Reversible interface. When something is reversible the Command builds a mirror opposite Command that can be queried of the Command. When a Command is reversible the undo service records the reverse command after the original Command runs. Otherwise it records a snapshot Command after the original Command runs.<br />
</p>
<p>
In the shortest term we could keep all the undo history in ram and have user specify the amount to devote to Undo. And then we could purge older undo states when users continue to change data.<br />
</p>
<p>
In the longer term we could use smart disk caching data structures that control how much ram they use and from which data can be pulled out. So in Imglib we could make an UndoImg (or MemoryLimitedCachingImg etc.) that would do this work.<br />
</p>
<p>
There are some user interaction issues as well. We might detect that a change will be larger than the undo history could absorb. So warn user that this is not undoable and ask to proceed (with "never ask me again" a choosable option).<br />
</p>
<p>
One future enhancement: save entire workspace to disk when IJ2 exits and optionally restore it the next time IJ2 is launched.<br />
</p>

    </div>

                <div class="trac-lastedit ">
                  Last edited <a class="timeline" href="/timeline?from=2012-09-20T12%3A04%3A19-05%3A00&amp;precision=second" title="2012-09-20T12:04:19-05:00 in Timeline">7 years</a> ago
                      by bdezonia
                    (<a href="/ticket/13?cversion=3&amp;cnum_hist=12#comment:12">previous</a>)
                    (<a href="/ticket/13?action=comment-diff&amp;cnum=12&amp;version=4">diff</a>)
                </div>
              </div>
              <div class="change" id="trac-change-13">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:13" class="cnum">
      <a href="#comment:13">comment:13</a>
    </span>
                          <span>follow-up:</span>
      <a href="#comment:14">â†“Â 14</a>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2012-09-20T13%3A38%3A44-05%3A00&amp;precision=second" title="2012-09-20T13:38:44-05:00 in Timeline">7 years</a> ago by gharris
                </h3>
                
    <div class="comment searchable">
      
      <p>
Another strategy is to store the large undo objects off the heap using java.nio.<br />
An example of this approach is in envisaje / ImageNIO.<br />
They have a [Byte|Int]NIOBufferedImage class where DataBuffer, WritableRaster, SinglePixelPackedSampleModel methods are overridden to use NIO.  I wonder how this sort of approach could be applied to imglib2 data objects.  My sense is that there is some overlap with addressing the ability to have a virtual stack.<br />
</p>
<p>
The NIOBufferedImage code is here:<br />
<a class="ext-link" href="https://github.com/imagej/envisaje/tree/master/ImageNIO/src/main/java/imagej/envisaje/imagenio"><span class="icon">Â </span>https://github.com/imagej/envisaje/tree/master/ImageNIO/src/main/java/imagej/envisaje/imagenio</a><br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-14">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:14" class="cnum">
      <a href="#comment:14">comment:14</a>
    </span>
                        in reply to:
      <a href="#comment:13">â†‘Â 13</a>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2012-09-21T14%3A34%3A29-05%3A00&amp;precision=second" title="2012-09-21T14:34:29-05:00 in Timeline">7 years</a> ago by curtis
                </h3>
                
    <div class="comment searchable">
      
      <p>
Replying to <a href="/ticket/13#comment:13" title="Comment 13 for Ticket #13">gharris</a>:<br />
</p>
<blockquote class="citation">
<p>
Another strategy is to store the large undo objects off the heap using java.nio.<br />
</p>
</blockquote>
<p>
I've been wondering for a while what the practical advantage of doing this is. I found <a class="ext-link" href="http://www.kdgregory.com/index.php?page=java.byteBuffer"><span class="icon">Â </span>a nice article</a> that provides a pretty thorough discussion of Java I/O including NIO stuff (i.e., <tt>ByteBuffer.allocateDirect()</tt>). From the article:<br />
</p>
<blockquote>
<p>
You might think that a direct buffer is a great way to extend the memory that your program can use. It isn't. The JVM is very good about growing the heap to the limits of physical and virtual memory, so if you've already maxed out your heap, there won't be any place to put a direct buffer.<br />
</p>
</blockquote>
<blockquote>
<p>
In fact, the only reason that I can see for using direct buffers in a pure Java program is that they won't be moved during garbage collection.<br />
</p>
</blockquote>
<p>
But are garbage collection issues really something that is specifically relevant to undo/redo?<br />
</p>
<p>
What is more interesting to me is using NIO in combination with JNI:<br />
</p>
<blockquote>
<p>
Direct buffers are useful in a program that mixes Java and native libraries: JNI provides methods to access the physical memory behind a direct buffer.<br />
</p>
</blockquote>
<p>
But that's not related to this ticket, of course.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-15">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:15" class="cnum">
      <a href="#comment:15">comment:15</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2012-10-05T16%3A30%3A19-05%3A00&amp;precision=second" title="2012-10-05T16:30:19-05:00 in Timeline">7 years</a> ago by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Owner</strong>
        changed from <em>curtis</em> to <em>bdezonia</em>
    </li><li>
      <strong>Status</strong>
        changed from <em>accepted</em> to <em>assigned</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
bdezonia has been developing support for this on the 'undo' branch, so I am assigning this ticket to him.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-16">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:16" class="cnum">
      <a href="#comment:16">comment:16</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2012-10-15T11%3A59%3A17-05%3A00&amp;precision=second" title="2012-10-15T11:59:17-05:00 in Timeline">7 years</a> ago by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Owner</strong>
        changed from <em>bdezonia</em> to <em>curtis</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Note that ctrueden has taken the 'undo' branch and begun modifying it on the 'undo-ctr' branch. Assigning this ticket to him for now.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-17">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:17" class="cnum">
      <a href="#comment:17">comment:17</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2012-10-15T12%3A17%3A22-05%3A00&amp;precision=second" title="2012-10-15T12:17:22-05:00 in Timeline">7 years</a> ago by curtis
                </h3>
                
    <div class="comment searchable">
      
      <p>
We were hoping to get undo working for beta5, but unfortunately there will not be time. After thinking things through further, and discussing with bdezonia, there are still too many changes and improvements we want to make to the undo functionality.<br />
</p>
<p>
The undo branch provides a good start on undo/redo functionality by providing an invertible operation interface, so each command can define its inverse in a flexible way. It also provides default behavior when a command is not natively invertible: saving and restoring of display snapshots. However, we need to push this logic into the module layer, so any module can be undone/redone, not just commands. We can then simplify the UndoService to require that each module be undoable. The CommandModule class can encapsulate the undo case logic, using its linked command's inverse operation if there is one, and using the snapshot restoration otherwise.<br />
</p>
<p>
We also need the snapshot restoration to be generalized to support any type of output. (Though as an aside, note that module items of type ItemIO.BOTH are the only ones that need to be saved and restored for the purposes of undo; ItemIO.INPUTs are assumed not to change, and ItemIO.OUTPUTs are assumed to have been created by the module rather than modified from an earlier state.) The display state logic currently on the undo branch is a good start for managing snapshots of displays (specifically image displays), but for other types of mutable outputs (ResultsTables come to mind) we will need an extensible way for managing snapshots. Our best bet may be to define a new type of ImageJ plugin responsible for managing snapshots of certain types (sort of like how each widget manages inputs of a particular type and UI). In this way, we could support managing snapshots of third party objects (as opposed to requiring that undoable objects be defined a certain way, such as being serializable or implementing a specific interface).<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-18">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:18" class="cnum">
      <a href="#comment:18">comment:18</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2012-10-19T15%3A45%3A44-05%3A00&amp;precision=second" title="2012-10-19T15:45:44-05:00 in Timeline">7 years</a> ago by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocking</strong>
        <em>1543</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-19">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:19" class="cnum">
      <a href="#comment:19">comment:19</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2012-11-21T09%3A55%3A53-06%3A00&amp;precision=second" title="2012-11-21T09:55:53-06:00 in Timeline">7 years</a> ago by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        changed from <em>imagej-2.0.0-beta7</em> to <em>imagej-2.0.0-beta6</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-20">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:20" class="cnum">
      <a href="#comment:20">comment:20</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2012-12-27T10%3A53%3A17-06%3A00&amp;precision=second" title="2012-12-27T10:53:17-06:00 in Timeline">7 years</a> ago by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        changed from <em>imagej2-b6-legacy-undo</em> to <em>imagej2-b7-ndim-data</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-21">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:21" class="cnum">
      <a href="#comment:21">comment:21</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-03-07T13%3A00%3A25-06%3A00&amp;precision=second" title="2013-03-07T13:00:25-06:00 in Timeline">6 years</a> ago by bdezonia
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        changed from <em>imagej2-b7-ndim-data</em> to <em>imagej2-unscheduled</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-22">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:22" class="cnum">
      <a href="#comment:22">comment:22</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-04-15T09%3A55%3A25-05%3A00&amp;precision=second" title="2013-04-15T09:55:25-05:00 in Timeline">6 years</a> ago by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        changed from <em>imagej2-unscheduled</em> to <em>imagej2-b10-compatibility</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-10">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:10" class="cnum">
      <a href="#comment:10">comment:10</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2014-05-06T09%3A15%3A58-05%3A00&amp;precision=second" title="2014-05-06T09:15:58-05:00 in Timeline">5 years</a> ago by curtis
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>assigned</em> to <em>closed</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>moved</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Migrated to <a class="ext-link" href="https://github.com/imagej/imagej-common/issues/3"><span class="icon">Â </span>https://github.com/imagej/imagej-common/issues/3</a><br />
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="/wiki/TracTickets">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="/ticket/13?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="/ticket/13?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="/ticket/13?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="/chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="/about"><strong>Trac 0.12.2</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the ImageJ project at<br /><a href="http://developer.imagej.net/">http://developer.imagej.net/</a></p>
    </div>
  </body>
</html>