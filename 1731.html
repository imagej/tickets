<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  
  <!-- See: http://trac.edgewall.org/wiki/TracInterfaceCustomization -->


  <head>
    <title>
      #1731 (Make sure Fiji infrastructure is properly backed up)
     – ImageJ
    </title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <link rel="search" href="/search" />
        <link rel="prev" href="/ticket/1730" title="Ticket #1730" />
        <link rel="last" href="/ticket/2043" title="Ticket #2043" />
        <link rel="help" href="/wiki/TracGuide" />
        <link rel="alternate" href="/ticket/1731?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="/ticket/1731?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="/ticket/1731?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="next" href="/ticket/1732" title="Ticket #1732" />
        <link rel="start" href="/wiki" />
        <link rel="stylesheet" href="/chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="/chrome/common/css/ticket.css" type="text/css" /><link rel="stylesheet" href="/chrome/vote/css/tracvote.css" type="text/css" />
        <link rel="first" href="/ticket/1" title="Ticket #1" />
        <link rel="shortcut icon" href="/chrome/site/imagej-16.png" type="image/png" />
        <link rel="icon" href="/chrome/site/imagej-16.png" type="image/png" />
      <link type="application/opensearchdescription+xml" rel="search" href="/search/opensearch" title="Search ImageJ" />
    <script type="text/javascript">
      var auto_preview_timeout=2.0;
      var form_token="b903b45bd0b7d64f9786396f";
    </script>
    <script type="text/javascript" src="/chrome/common/js/jquery.js"></script><script type="text/javascript" src="/chrome/common/js/babel.js"></script><script type="text/javascript" src="/chrome/common/js/trac.js"></script><script type="text/javascript" src="/chrome/common/js/search.js"></script><script type="text/javascript" src="/chrome/common/js/folding.js"></script><script type="text/javascript" src="/chrome/common/js/wikitoolbar.js"></script><script type="text/javascript" src="/chrome/common/js/resizer.js"></script><script type="text/javascript" src="/chrome/common/js/auto_preview.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        var args = {realm: "ticket", id: 1731, escape_newlines: 1}
        $("#comment").autoPreview("/wiki_render", args, function(textarea, text, rendered) {
            $("#ticketchange div.comment").html(rendered);
            if (rendered)
              $("#ticketchange").show();
            else if ($("#ticketchange ul.changes").length == 0)
              $("#ticketchange").hide();
        });
        $("#trac-comment-editor textarea").autoPreview("/wiki_render", args,
                                                       function(textarea, text, rendered) {
          var comment = $("#trac-comment-editor").next("div.comment");
          comment.html(rendered);
          if (rendered)
            comment.show();
          else
            comment.hide();
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() { $("#modify").parent().removeClass("collapsed"); });
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[id]").enable($(this).checked());
            $(this).siblings().filter("*[id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="/chrome/site/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="http://developer.imagej.net/"><img src="http://developer.imagej.net/files/imagej/logo.png" alt="ImageJ Trac" /></a>
      </div>
      <form id="search" action="/search" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="/login">Login</a></li><li><a href="/prefs">Preferences</a></li><li><a href="/wiki/TracGuide">Help/Guide</a></li><li><a href="/about">About Trac</a></li><li class="last"><a href="/reset_password">Forgot your password?</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="/wiki">Wiki</a></li><li><a href="/timeline">Timeline</a></li><li><a href="/roadmap">Roadmap</a></li><li class="active"><a href="/report">View Tickets</a></li><li class="last"><a href="/search">Search</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span id="vote" title="Vote count"><img src="/chrome/vote/aupgray.png" alt="Up-vote" /><span id="votes">+0</span><img src="/chrome/vote/adowngray.png" alt="Down-vote" /></span></li><li><span>&larr; <a class="prev" href="/ticket/1730" title="Ticket #1730">Previous Ticket</a></span></li><li><span><a class="next" href="/ticket/1732" title="Ticket #1732">Next Ticket</a> &rarr;</span></li><li class="last"><a href="/depgraph/1731">Depgraph</a></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1 id="trac-ticket-title">
          <a href="/ticket/1731">Ticket #1731</a>
          <span class="status">(closed defect: fixed)</span>
      </h1>
      <div id="ticket">
  <div class="date">
    <p>Opened <a class="timeline" href="/timeline?from=2013-03-25T15%3A01%3A25-05%3A00&amp;precision=second" title="2013-03-25T15:01:25-05:00 in Timeline">6 years</a> ago</p>
    <p>Last modified <a class="timeline" href="/timeline?from=2013-04-18T17%3A42%3A07-05%3A00&amp;precision=second" title="2013-04-18T17:42:07-05:00 in Timeline">6 years</a> ago</p>
  </div>
  <h2 class="summary searchable">Make sure Fiji infrastructure is properly backed up</h2>
  <table class="properties">
    <tr>
      <th id="h_reporter">Reported by:</th>
      <td headers="h_reporter" class="searchable">
        <a href="/query?status=!closed&amp;reporter=dscho">dscho</a>
      </td>
      <th id="h_owner">Owned by:</th>
      <td headers="h_owner">
        <a href="/query?status=!closed&amp;owner=dscho">dscho</a>
      </td>
    </tr>
    <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
              <a href="/query?status=!closed&amp;priority=major">major</a>
        </td>
        <th id="h_milestone">
          Milestone:
        </th>
        <td headers="h_milestone">
              <a class="closed milestone" href="/milestone/imagej2-b7-ndim-data">imagej2-b7-ndim-data</a>
        </td>
    </tr><tr>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
              <a href="/query?status=!closed&amp;component=Server+Admin">Server Admin</a>
        </td>
        <th id="h_version">
          Version:
        </th>
        <td headers="h_version">
              <a href="/query?status=!closed&amp;version="></a>
        </td>
    </tr><tr>
        <th id="h_severity">
          Severity:
        </th>
        <td headers="h_severity">
              <a href="/query?status=!closed&amp;severity=serious">serious</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td headers="h_keywords" class="searchable">
        </td>
    </tr><tr>
        <th id="h_cc">
          Cc:
        </th>
        <td headers="h_cc" class="searchable">
              <a href="/query?status=!closed&amp;cc=~curtis">curtis</a>
        </td>
        <th id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby">
        </td>
    </tr><tr>
        <th id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking">
              <a class="closed" href="/ticket/1729" title="Clean up after fiji.sc move to Madison [ndim-data]">#1729</a>, <a class="closed" href="/ticket/1757" title="Make http://fiji.sc/Fiji_Usage work again">#1757</a>
        </td>
        <th>
        </th>
        <td>
        </td>
    </tr>
  </table>
  <div class="description">
    <h3 id="comment:description">
      Description
    </h3>
    <div class="searchable">
      <p>
Probably as a Jenkins job, we should make sure that fiji.sc things are written properly to the /backup/ directory. The following databases and file system dumps need to be made:<br />
</p>
<ul><li>Fiji Wiki (including images/, extensions/ and skins/)
</li><li>Bugzilla
</li><li>IRC logs (shinybot)
</li><li>Git mirrors (or remove them?)
</li></ul>
    </div>
  </div>
</div>
          

        <div>
          <h2 class="foldable">Change History</h2>
          <div id="changelog">
              <div class="change" id="trac-change-1">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:1" class="cnum">
      <a href="#comment:1">comment:1</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-03-25T15%3A30%3A01-05%3A00&amp;precision=second" title="2013-03-25T15:30:01-05:00 in Timeline">6 years</a> ago by dscho
                </h3>
                
    <div class="comment searchable">
      
      <p>
Bugzilla needs the <em>bugzilla</em> MySQL database, the <em>/var/www/bugzilla/.git</em> repository and the <em>/etc/apache2/conf.d/bugzilla</em> file. The <em>libapache2-mod-perl2</em> module needs to be enabled, too.<br />
</p>
<p>
In addition, when re-installing, the <em>lib/</em> directory needs to be blown away and <em>install-modules.pl --all</em> needs to be run as root.<br />
</p>

    </div>

                <div class="trac-lastedit ">
                  Last edited <a class="timeline" href="/timeline?from=2013-03-25T16%3A24%3A35-05%3A00&amp;precision=second" title="2013-03-25T16:24:35-05:00 in Timeline">6 years</a> ago
                      by dscho
                    (<a href="/ticket/1731?cversion=1&amp;cnum_hist=1#comment:1">previous</a>)
                    (<a href="/ticket/1731?action=comment-diff&amp;cnum=1&amp;version=2">diff</a>)
                </div>
              </div>
              <div class="change" id="trac-change-2">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:2" class="cnum">
      <a href="#comment:2">comment:2</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-03-25T15%3A32%3A02-05%3A00&amp;precision=second" title="2013-03-25T15:32:02-05:00 in Timeline">6 years</a> ago by dscho
                </h3>
                
    <div class="comment searchable">
      
      <p>
Fiji Wiki requires the <em>wikidb3</em> database, the <em>/var/www/mediawiki/phase3/images/</em> directory (owned by <em>www-data.www-data</em>) and the <em>/var/www/mediawiki/{,phase3/extensions/,phase3/skins/}.git</em> repositories.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-3">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:3" class="cnum">
      <a href="#comment:3">comment:3</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-03-27T13%3A05%3A39-05%3A00&amp;precision=second" title="2013-03-27T13:05:39-05:00 in Timeline">6 years</a> ago by dscho
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Blocking</strong>
        <em>1757</em> added
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
(In <a class="closed ticket" href="/ticket/1757" title="defect: Make http://fiji.sc/Fiji_Usage work again (closed: fixed)">#1757</a>) It seems that in addition to <a class="closed ticket" href="/ticket/1733" title="defect: Make the Pacific-access-logs job work again (closed: fixed)">#1733</a>, this required copying fiji-dot.png and openlayers/ to the appropriate directory.<br />
</p>
<p>
Leaving this open until <a class="closed ticket" href="/ticket/1731" title="defect: Make sure Fiji infrastructure is properly backed up (closed: fixed)">#1731</a> is fixed (and includes backing up the stuff for the usage map).<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-4">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:4" class="cnum">
      <a href="#comment:4">comment:4</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-03-28T09%3A34%3A11-05%3A00&amp;precision=second" title="2013-03-28T09:34:11-05:00 in Timeline">6 years</a> ago by dscho
                </h3>
                
    <div class="comment searchable">
      
      <p>
To be precise, the usage map requires the file fiji-dot.png and the Git checkout openlayers/ in awesome/ to be backed up, too.<br />
</p>
<p>
While at it, favicon.ico and downloads/ should be backed up for the Fiji Wiki to work, too. Oh, and LocalSettings.php would be rather crucial, too...<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-5">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:5" class="cnum">
      <a href="#comment:5">comment:5</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-03-28T09%3A36%3A55-05%3A00&amp;precision=second" title="2013-03-28T09:36:55-05:00 in Timeline">6 years</a> ago by dscho
                </h3>
                
    <div class="comment searchable">
      
      <p>
For GitWeb to work, the <em>static</em> symlink and <em>httpd.include</em> are important. The repositories are expected to live in /data/git, and Git is expected to be installed from Git for Windows' source (<a class="ext-link" href="https://github.com/msysgit/git"><span class="icon"> </span>https://github.com/msysgit/git</a>); The <em>httpd.include</em> includes all the information required to run the smart HTTP backend and GitWeb.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-6">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:6" class="cnum">
      <a href="#comment:6">comment:6</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-03-28T11%3A41%3A44-05%3A00&amp;precision=second" title="2013-03-28T11:41:44-05:00 in Timeline">6 years</a> ago by dscho
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Milestone</strong>
        changed from <em>imagej2-unscheduled</em> to <em>imagej2-b7-ndim-data</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      
    </div>

              </div>
              <div class="change" id="trac-change-7">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:7" class="cnum">
      <a href="#comment:7">comment:7</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-03-28T13%3A19%3A52-05%3A00&amp;precision=second" title="2013-03-28T13:19:52-05:00 in Timeline">6 years</a> ago by dscho
                </h3>
                
    <div class="comment searchable">
      
      <p>
The code search facility (e.g. <a class="ext-link" href="http://fiji.sc/IJ.java"><span class="icon"> </span>http://fiji.sc/IJ.java</a>) requires <em>cgi-bin/search.cgi</em> to be backed up in addition to <em>httpd.include</em>.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-8">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:8" class="cnum">
      <a href="#comment:8">comment:8</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-04-01T19%3A48%3A56-05%3A00&amp;precision=second" title="2013-04-01T19:48:56-05:00 in Timeline">6 years</a> ago by dscho
                </h3>
                
    <div class="comment searchable">
      
      <p>
Fiji's samples reside in the <em>samples/</em> directory which also needs to be backed up.<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-9">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:9" class="cnum">
      <a href="#comment:9">comment:9</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-04-14T23%3A51%3A40-05%3A00&amp;precision=second" title="2013-04-14T23:51:40-05:00 in Timeline">6 years</a> ago by dscho
                </h3>
                
    <div class="comment searchable">
      
      <p>
Started work in <a class="ext-link" href="http://jenkins.imagej.net/job/Backup-fiji.sc/"><span class="icon"> </span>http://jenkins.imagej.net/job/Backup-fiji.sc/</a><br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-10">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:10" class="cnum">
      <a href="#comment:10">comment:10</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-04-18T17%3A19%3A19-05%3A00&amp;precision=second" title="2013-04-18T17:19:19-05:00 in Timeline">6 years</a> ago by dscho
                </h3>
                
    <div class="comment searchable">
      
      <p>
The uploaded sample images from <a class="ext-link" href="http://upload.imagej.net/"><span class="icon"> </span>http://upload.imagej.net/</a> need to be backed up, too (since Fiji's Help&gt;Upload Sample Image uses ImageJ2's command to do the job).<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-11">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:11" class="cnum">
      <a href="#comment:11">comment:11</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-04-18T17%3A34%3A24-05%3A00&amp;precision=second" title="2013-04-18T17:34:24-05:00 in Timeline">6 years</a> ago by dscho
                </h3>
                
    <div class="comment searchable">
      
      <p>
The <em>Backup-fiji.sc</em> job now makes sure that the Wiki database, the BugZilla database, the Geolocation database, the Wiki files, the virtual host configuration, and the GitWeb configuration are written into timestamped files in <em>/backup/fiji/</em>.<br />
</p>
<p>
It also makes sure that files that are not supposed to change are rsync'ed into <em>/backup/fiji-eden/' (to avoid unnecessary copying). These files are in </em>downloads/<em>, </em>images/<em>, </em>javadoc/<em>, </em>samples/<em> and </em>update/<em>.<br />
</em></p>
<p>
Finally, it clones the <em>.git/</em> directories into bare mirror repositories in <em>/backup/fiji-eden/</em>.<br />
</p>
<p>
Once all that is done, the <em>Backup-fiji.sc</em> job cleans up files older than 2 weeks in <em>/backup/fiji</em>.<br />
</p>
<p>
The <em>Backup-Uploaded-Sample-Images</em> job backs those images up, into <em>/backup/sample-images/</em>. I also copied the uploaded sample images from pacific.<br />
</p>
<p>
It appears that rsync is really slow, despite using the <em>-u</em> option (only newer files)... :-(<br />
</p>

    </div>

              </div>
              <div class="change" id="trac-change-12">
                <h3 class="change">
                  <span class="threading">
                    <span id="comment:12" class="cnum">
      <a href="#comment:12">comment:12</a>
    </span>
                  </span>
                  Changed <a class="timeline" href="/timeline?from=2013-04-18T17%3A42%3A07-05%3A00&amp;precision=second" title="2013-04-18T17:42:07-05:00 in Timeline">6 years</a> ago by dscho
                </h3>
                
  <ul class="changes">
    <li>
      <strong>Status</strong>
        changed from <em>new</em> to <em>closed</em>
    </li><li>
      <strong>Resolution</strong>
        set to <em>fixed</em>
    </li>
  </ul>
    <div class="comment searchable">
      
      <p>
Luckily, rsync is only slow the first time. The <em>Backup-fiji.sc</em> job took 1h11min for the run that finally put all things into the correct places (actually, the Git repositories were already cloned by the same script but outside Jenkins), but now it only takes 2min45sec.<br />
</p>
<p>
At the time of writing, the <em>Backup-Uploaded-Sample-Images</em> job still is crunching away on its initial run.<br />
</p>

    </div>

              </div>
          </div>
        </div>
      <div id="help"><strong>Note:</strong> See
        <a href="/wiki/TracTickets">TracTickets</a> for help on using
        tickets.</div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="/ticket/1731?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="/ticket/1731?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="/ticket/1731?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="/chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">Powered by <a href="/about"><strong>Trac 0.12.2</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.</p>
      <p class="right">Visit the ImageJ project at<br /><a href="http://developer.imagej.net/">http://developer.imagej.net/</a></p>
    </div>
  </body>
</html>
